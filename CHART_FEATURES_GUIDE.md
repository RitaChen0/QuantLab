# 📊 高级图表功能指南

## 🎉 新增图表类型

预测页面现在支持 **5 种专业图表类型**，全部使用 ECharts 实现，提供交互式、高性能的数据可视化！

---

## 🎨 图表类型总览

### 1. 📈 折线图（Line Chart）

**用途**：观察预测值随时间的趋势变化

**特点**：
- ✅ 平滑曲线展示预测走势
- ✅ 买入/卖出信号标注（绿色/红色散点）
- ✅ 阈值线标记（虚线）
- ✅ 渐变填充区域
- ✅ 交互式 Tooltip（悬停显示详情）

**适用场景**：
- 查看单支股票的预测趋势
- 识别买入/卖出时机
- 观察预测值波动幅度

**可视化元素**：
```
📈 蓝色曲线：预测值走势（平滑）
🟢 绿色虚线：买入阈值（+0.02）
🔴 红色虚线：卖出阈值（-0.02）
🔵 绿色散点：买入信号日
🔴 红色散点：卖出信号日
🎨 渐变背景：蓝色渐变填充
```

---

### 2. 📊 K线图（Candlestick Chart）

**用途**：以蜡烛图形式展示预测值的波动范围

**特点**：
- ✅ 红绿蜡烛体（上涨绿色，下跌红色）
- ✅ 模拟 OHLC 数据（开、高、低、收）
- ✅ 阈值标记线
- ✅ 缩放和拖拽功能（DataZoom）
- ✅ 十字光标辅助线

**适用场景**：
- 分析预测值的波动范围
- 类比股票 K线图分析
- 观察预测不确定性

**模拟逻辑**：
```python
# 基于预测值生成模拟 OHLC
开盘价 = 0
收盘价 = 预测值
最高价 = 预测值 > 0 ? 预测值 * 1.2 : abs(预测值) * 0.2
最低价 = 预测值 < 0 ? 预测值 * 1.2 : -abs(预测值) * 0.2
```

**交互功能**：
- 🖱️ **鼠标滚轮缩放**：放大/缩小时间轴
- 👆 **拖拽滑块**：选择查看日期范围
- 🎯 **十字光标**：精准定位数据点

---

### 3. 🔵 散点图（Scatter Chart）

**用途**：观察预测值的分布和离散程度

**特点**：
- ✅ 按信号类型着色（绿/灰/红）
- ✅ VisualMap 颜色映射
- ✅ 显示预测值的分布密度
- ✅ 识别异常值和集中区域

**适用场景**：
- 查看预测值的整体分布
- 识别预测极端值
- 分析信号集中度

**颜色编码**：
```
🟢 绿色散点：买入信号（预测值 > 0.02）
⚫ 灰色散点：持有信号（-0.02 ~ 0.02）
🔴 红色散点：卖出信号（预测值 < -0.02）
```

**VisualMap 梯度**：
```
强看空（红色） ← 中性（灰色） → 强看多（绿色）
   -0.05           0.00          +0.05
```

---

### 4. 🥧 信号分布饼图（Pie Chart）

**用途**：直观展示买入/卖出/持有信号的占比

**特点**：
- ✅ 环形饼图设计
- ✅ 显示具体数量和百分比
- ✅ 悬停高亮效果
- ✅ 图例交互（点击隐藏/显示）

**适用场景**：
- 评估交易信号分布
- 检查是否过度交易
- 判断模型偏向性

**健康分布参考**：
```
✅ 理想分布：
   买入信号：10-20%
   持有观望：60-80%
   卖出信号：10-20%

⚠️ 不健康分布：
   买入信号 > 40%：过度乐观，阈值过低
   买入信号 < 5%：阈值过高，错过机会
   卖出信号 > 40%：过度悲观
```

**图表展示**：
```
        买入信号
         15 (25%)
       /          \
    持有观望      卖出信号
    40 (66%)      5 (8%)
```

---

### 5. 🌡️ 全局热力图（Heatmap）

**用途**：同时对比多支股票的预测热度

**特点**：
- ✅ 二维矩阵展示（股票 × 日期）
- ✅ 颜色梯度映射（红→白→绿）
- ✅ 自动显示最近 30 天
- ✅ 快速识别强势/弱势股票

**适用场景**：
- 批量对比多支股票
- 识别板块轮动
- 发现集体看多/看空日期

**颜色含义**：
```
🔴 深红色：强看空（预测值 < -0.03）
🟠 浅红色：看空（预测值 -0.03 ~ -0.01）
⚪ 白色：中性（预测值 -0.01 ~ +0.01）
🟢 浅绿色：看多（预测值 +0.01 ~ +0.03）
🟩 深绿色：强看多（预测值 > +0.03）
```

**使用技巧**：
- **横向看**：某日期所有股票的预测情况
- **纵向看**：某股票在时间序列上的预测变化
- **颜色集中区**：市场一致性强的时期

---

## 🎯 图表切换操作

### 切换方式

在每支股票的详细信息中，点击顶部的图表选项卡：

```
┌──────────────────────────────────────────┐
│ 📈 折线图 | 📊 K线图 | 🔵 散点图 | 🥧 信号分布 │
└──────────────────────────────────────────┘
```

- **默认显示**：折线图
- **切换效果**：即时渲染，无需重新请求数据
- **独立记忆**：每支股票的图表类型独立保存

---

## 📊 实战使用示例

### 场景 1：台指期货短期交易

**目标**：预测台指期货未来 7 天，找出最佳买入点

**步骤**：
```
1. 选择 TXCONT，日期范围：最近 7 天
2. 生成预测
3. 展开 TXCONT
4. 📈 切换到「折线图」
   → 观察预测曲线，找到绿色买入信号点
5. 📊 切换到「K线图」
   → 观察预测波动范围，评估风险
6. 🥧 切换到「信号分布」
   → 确认买入信号占比（理想 10-20%）
```

**决策依据**：
- 折线图显示 3 个买入信号日
- K线图显示波动适中
- 信号分布：买入 15%，持有 80%，卖出 5%
- **结论**：可以在买入信号日开仓

---

### 场景 2：批量筛选潜力股

**目标**：从 10 支股票中找出最有潜力的 2-3 支

**步骤**：
```
1. 选择热门股票 + 科技股（10支）
2. 日期范围：最近 30 天
3. 生成预测
4. 🌡️ 查看「全局热力图」
   → 横向对比，找出绿色最多的股票
5. 逐个展开候选股票
6. 🔵 切换到「散点图」
   → 观察预测值分布，避免极端波动
7. 📈 切换到「折线图」
   → 确认买入信号日期
```

**筛选标准**：
- 热力图中绿色区域占比 > 50%
- 散点图中预测值集中在正值区间
- 折线图中买入信号 ≥ 5 个
- **结果**：筛选出 2330、2454、2308

---

### 场景 3：验证模型预测质量

**目标**：评估模型在历史数据上的表现

**步骤**：
```
1. 选择历史时间段（如 2024-11 月）
2. 生成预测
3. 🥧 查看「信号分布饼图」
   → 检查信号分布是否健康
4. 📊 切换到「K线图」
   → 观察预测波动是否合理
5. 导出 CSV
6. 对比实际价格计算胜率
```

**质量评估**：
```
✅ 合格模型：
   - 信号分布健康（买入 10-20%）
   - K线图波动适中（无异常极值）
   - 胜率 > 55%

❌ 需要重新训练：
   - 信号分布极端（买入 > 40% 或 < 5%）
   - K线图波动过大
   - 胜率 < 50%
```

---

## 🎨 图表交互功能

### 通用交互

**所有图表支持**：
- 🖱️ **悬停 Tooltip**：显示详细数据
- 📊 **图例点击**：隐藏/显示数据系列
- 💾 **右键菜单**：保存为图片
- 📏 **自动缩放**：响应窗口大小调整

### K线图专属

**缩放功能**：
- 🖱️ **滚轮缩放**：放大查看细节
- 👆 **滑块拖拽**：选择日期范围
- ⌨️ **快捷键**：
  - `Shift + 滚轮`：横向滚动
  - `Ctrl + 滚轮`：纵向缩放

### 散点图专属

**VisualMap 交互**：
- 🎨 **拖拽滑块**：调整颜色范围
- 🔍 **数值过滤**：只显示特定范围的点
- 🎯 **精确定位**：点击散点查看详情

### 热力图专属

**矩阵导航**：
- 🖱️ **悬停高亮**：突出显示当前格子
- 📅 **日期筛选**：自动显示最近 30 天
- 📈 **动态高度**：根据股票数量自动调整

---

## 💡 高级用法

### 技巧 1：组合分析

**同时使用多种图表**：
```
折线图 → 识别趋势
    ↓
K线图 → 评估风险
    ↓
散点图 → 确认分布
    ↓
饼图 → 验证信号占比
```

### 技巧 2：热力图板块分析

**识别板块轮动**：
```
1. 选择同板块股票（如：2330, 2454, 3008, 2382）
2. 查看热力图
3. 观察是否出现"列状绿色区域"
   → 说明该日期板块集体看多
4. 反之，"列状红色区域"
   → 板块集体看空
```

### 技巧 3：信号确认策略

**多图表交叉验证**：
```
买入决策流程：
1. 折线图：预测值 > 0.02 ✅
2. K线图：波动范围合理（无异常大阴线）✅
3. 散点图：该点位于绿色集中区 ✅
4. 饼图：买入信号占比 < 30% ✅
→ 4 个条件都满足，可以买入
```

---

## 🎓 图表解读技巧

### 折线图

**看什么**：
- 📈 **趋势方向**：向上=看多，向下=看空
- 🎯 **信号位置**：绿点=买入，红点=卖出
- 📏 **波动幅度**：平滑=稳定，剧烈=高风险

**警告信号**：
- ⚠️ 预测值频繁穿越 0 轴：模型不确定
- ⚠️ 买入信号过密：阈值过低

### K线图

**看什么**：
- 🟢 **绿色蜡烛**：预测看多
- 🔴 **红色蜡烛**：预测看空
- 📏 **影线长度**：预测不确定性

**警告信号**：
- ⚠️ 蜡烛体过长：预测极端值，需谨慎
- ⚠️ 影线过长：模型信心不足

### 散点图

**看什么**：
- 🎨 **颜色分布**：绿多=看多，红多=看空
- 📊 **密度集中**：集中=稳定，分散=波动
- 🎯 **异常值**：远离集群的点

**警告信号**：
- ⚠️ 散点极度分散：模型不稳定
- ⚠️ 出现异常极值（±0.10 以上）

### 饼图

**看什么**：
- 🥧 **最大扇形**：持有应占最大
- 📊 **买卖平衡**：买入≈卖出为佳
- 🎯 **极端占比**：任一信号 > 40% 需警惕

**警告信号**：
- ⚠️ 买入信号 > 40%：模型过度乐观
- ⚠️ 持有信号 < 50%：过度交易

### 热力图

**看什么**：
- 🌈 **颜色趋势**：从红到绿=转强
- 📅 **列状区域**：同日期集体信号
- 📈 **行状区域**：个股持续趋势

**警告信号**：
- ⚠️ 红绿剧烈交替：市场不确定
- ⚠️ 全红或全绿：模型可能过拟合

---

## 📚 技术细节

### ECharts 配置

**图表库**：Apache ECharts 5.x

**优势**：
- ✅ 高性能渲染（Canvas）
- ✅ 丰富的图表类型
- ✅ 完善的交互功能
- ✅ 移动端友好

### 数据处理

**实时性**：
- 所有图表基于同一份预测数据
- 切换图表无需重新请求
- 图表间数据保持一致

**缓存机制**：
- 图表实例缓存（避免重复创建）
- 自动销毁旧实例（防止内存泄漏）
- 响应式调整（窗口大小改变时）

---

## 🆕 未来计划

### 即将推出

- 🔜 **箱线图**：显示预测值的统计分布
- 🔜 **雷达图**：多维度因子贡献分析
- 🔜 **3D 曲面图**：时间-股票-预测值三维展示
- 🔜 **关联图**：股票间预测相关性网络
- 🔜 **仪表盘**：模型信心度指示器

### 功能增强

- 图表联动（点击热力图自动展开对应股票）
- 自定义配色方案
- 图表组合视图（同时显示 2-3 个图表）
- 动画播放（时间序列动态演示）
- 导出高清 PNG/SVG

---

## 🚀 快速开始

```
1. 访问预测页面
2. 生成预测
3. 展开任意股票
4. 点击顶部图表选项卡切换
5. 尝试不同图表类型
6. 使用鼠标交互探索数据
```

**立即体验全新的可视化功能！** 🎉
