# Dashboard å¸³æˆ¶é¤˜é¡åˆ·æ–°ä¿®å¾©

## ğŸ› å•é¡Œæè¿°

**ç—‡ç‹€**: ç”¨æˆ¶é‡æ–°ç™»å…¥å¾Œï¼ŒDashboard é é¢çš„å¸³æˆ¶é¤˜é¡ï¼ˆç¾é‡‘å’Œä¿¡ç”¨ï¼‰ä¸æœƒæ›´æ–°ï¼Œä»é¡¯ç¤ºèˆŠçš„æ•¸æ“šã€‚

**æ ¹æœ¬åŸå› **:
1. **ç™»å…¥é é¢**: ä½¿ç”¨ `router.push('/dashboard')` é€²è¡Œå®¢æˆ¶ç«¯å°èˆªï¼Œä¸æœƒè§¸ç™¼å®Œæ•´çš„é é¢é‡æ–°è¼‰å…¥
2. **Dashboard é é¢**: åªåœ¨ `onMounted` æ™‚è¼‰å…¥æ•¸æ“šï¼Œå¦‚æœçµ„ä»¶å·²ç¶“æ›è¼‰éï¼Œé‡æ–°è¨ªå•æ™‚ä¸æœƒåˆ·æ–°
3. **Vue Router ç·©å­˜**: SPA æ¨¡å¼ä¸‹ï¼ŒVue Router å¯èƒ½ç·©å­˜çµ„ä»¶ç‹€æ…‹

## âœ… ä¿®å¾©æ–¹æ¡ˆ

### 1. ç™»å…¥é é¢ä¿®æ”¹ (`frontend/pages/login.vue`)

**ä¿®æ”¹å‰**:
```javascript
if (result.success) {
  // ä½¿ç”¨ Vue Router å°èˆªï¼ˆä¸æœƒé‡æ–°è¼‰å…¥é é¢ï¼‰
  await router.push('/dashboard')
}
```

**ä¿®æ”¹å¾Œ**:
```javascript
if (result.success) {
  // å¼·åˆ¶å®Œæ•´é é¢åˆ·æ–°ï¼Œç¢ºä¿æ‰€æœ‰æ•¸æ“šé‡æ–°è¼‰å…¥
  window.location.href = '/dashboard'
}
```

**å„ªé»**:
- âœ… æ¸…é™¤æ‰€æœ‰ç·©å­˜çš„ç‹€æ…‹
- âœ… é‡æ–°åŸ·è¡Œ `onMounted` hook
- âœ… ç¢ºä¿ç²å–æœ€æ–°çš„ API æ•¸æ“š
- âœ… ç°¡å–®å¯é 

### 2. Dashboard é é¢å¢å¼· (`frontend/pages/dashboard/index.vue`)

æ–°å¢ä¸‰å€‹åˆ·æ–°æ©Ÿåˆ¶ï¼š

#### A. `onActivated` Hook
```javascript
// ç•¶é é¢é‡æ–°æ¿€æ´»æ™‚åˆ·æ–°æ•¸æ“šï¼ˆä¾‹å¦‚å¾å…¶ä»–é é¢è¿”å›ï¼‰
onActivated(() => {
  console.log('Dashboard activated, refreshing data...')
  loadMembershipInfo()
  loadDashboardData()
})
```

**ç”¨é€”**: ç•¶ç”¨æˆ¶å¾ Admin æˆ–å…¶ä»–é é¢è¿”å› Dashboard æ™‚ï¼Œè‡ªå‹•åˆ·æ–°æ•¸æ“šã€‚

#### B. å¯è¦‹æ€§ç›£è½
```javascript
// ç›£è½é é¢å¯è¦‹æ€§è®ŠåŒ–ï¼Œç•¶é é¢é‡æ–°å¯è¦‹æ™‚åˆ·æ–°æ•¸æ“š
if (process.client) {
  onMounted(() => {
    const handleVisibilityChange = () => {
      if (!document.hidden) {
        console.log('Page became visible, refreshing data...')
        loadMembershipInfo()
      }
    }
    document.addEventListener('visibilitychange', handleVisibilityChange)

    onUnmounted(() => {
      document.removeEventListener('visibilitychange', handleVisibilityChange)
    })
  })
}
```

**ç”¨é€”**: ç•¶ç”¨æˆ¶åˆ‡æ›ç€è¦½å™¨æ¨™ç±¤å¾Œè¿”å›æ™‚ï¼Œè‡ªå‹•åˆ·æ–°æ•¸æ“šã€‚

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### æ¸¬è©¦å ´æ™¯ 1: é‡æ–°ç™»å…¥
1. ç™»å…¥ç³»çµ±ï¼ˆä¾‹å¦‚ free_userï¼‰
2. é€²å…¥ Dashboardï¼ŒæŸ¥çœ‹å¸³æˆ¶é¤˜é¡ï¼ˆä¾‹å¦‚ $0.00ï¼‰
3. ç™»å‡º
4. åœ¨å¾Œå°æˆ– Admin é é¢ä¿®æ”¹ç”¨æˆ¶çš„ cash å’Œ credit
5. é‡æ–°ç™»å…¥
6. **é©—è­‰**: Dashboard æ‡‰è©²é¡¯ç¤ºæœ€æ–°çš„é¤˜é¡ï¼ˆä¾‹å¦‚ $1,500.75ï¼‰

### æ¸¬è©¦å ´æ™¯ 2: Admin ä¿®æ”¹å¾Œè¿”å›
1. ç™»å…¥ç®¡ç†å“¡å¸³è™Ÿ
2. é€²å…¥ Dashboardï¼Œè¨˜éŒ„ç•¶å‰é¤˜é¡
3. é€²å…¥ Admin é é¢
4. ä¿®æ”¹è‡ªå·±çš„ cash æˆ– credit
5. é»æ“Šç€è¦½å™¨çš„ã€Œè¿”å›ã€æŒ‰éˆ•æˆ–å°èˆªå› Dashboard
6. **é©—è­‰**: Dashboard æ‡‰è©²é¡¯ç¤ºæ›´æ–°å¾Œçš„é¤˜é¡

### æ¸¬è©¦å ´æ™¯ 3: åˆ‡æ›æ¨™ç±¤å¾Œè¿”å›
1. ç™»å…¥ä¸¦é€²å…¥ Dashboard
2. åˆ‡æ›åˆ°å…¶ä»–ç€è¦½å™¨æ¨™ç±¤
3. åœ¨å¦ä¸€å€‹æ¨™ç±¤ä¸­ä¿®æ”¹ç”¨æˆ¶é¤˜é¡ï¼ˆä¾‹å¦‚é€šé API æˆ– Admin é é¢ï¼‰
4. åˆ‡æ›å› Dashboard æ¨™ç±¤
5. **é©—è­‰**: Dashboard æ‡‰è©²åœ¨å¹¾ç§’å…§è‡ªå‹•åˆ·æ–°é¡¯ç¤ºæœ€æ–°é¤˜é¡

## ğŸ“Š API é©—è­‰

é©—è­‰ API è¿”å›æ­£ç¢ºæ•¸æ“šï¼š

```bash
# æ¸¬è©¦è…³æœ¬
bash /home/ubuntu/QuantLab/test_membership_refresh.sh
```

**é æœŸè¼¸å‡º**:
```
æ¸¬è©¦æœƒå“¡è³‡è¨Šåˆ·æ–°
==================

1. ç™»å…¥ free_user...
âœ… ç™»å…¥æˆåŠŸ

2. ç²å–æœƒå“¡è³‡è¨Š (GET /membership/me)...
  ç”¨æˆ¶å: free_user
  æœƒå“¡ç­‰ç´š: Level 0 (è¨»å†Šæœƒå“¡)
  ç¾é‡‘: $1500.75
  ä¿¡ç”¨: 750.50

  Rate Limits:
    å›æ¸¬åŸ·è¡Œ: 10/hour
    ç­–ç•¥å»ºç«‹: 10/hour
    è³‡æ–™æŸ¥è©¢: 100/minute
    å› å­æŒ–æ˜: 0/hour

âœ… æ¸¬è©¦å®Œæˆ
```

## ğŸ“ æŠ€è¡“ç´°ç¯€

### window.location.href vs router.push()

| æ–¹æ³• | è¡Œç‚º | å„ªé» | ç¼ºé» |
|------|------|------|------|
| `router.push()` | å®¢æˆ¶ç«¯å°èˆª | é€Ÿåº¦å¿«ã€ç„¡é–ƒçˆ | å¯èƒ½ä¸åˆ·æ–°æ•¸æ“š |
| `window.location.href` | å®Œæ•´é é¢åˆ·æ–° | ç¢ºä¿æ•¸æ“šæ›´æ–° | ç¨æ…¢ã€æœ‰çŸ­æš«ç™½å± |

**é¸æ“‡**: ç™»å…¥å ´æ™¯ä½¿ç”¨ `window.location.href`ï¼Œå› ç‚ºï¼š
- ç™»å…¥æ˜¯ä½é »æ“ä½œï¼ˆç”¨æˆ¶å¯æ¥å—ç¨æ…¢çš„é«”é©—ï¼‰
- ç¢ºä¿æ•¸æ“šä¸€è‡´æ€§æ¯”é€Ÿåº¦æ›´é‡è¦
- æ¸…é™¤ä»»ä½•æ½›åœ¨çš„ç·©å­˜ç‹€æ…‹

### Vue ç”Ÿå‘½é€±æœŸ Hooks

| Hook | è§¸ç™¼æ™‚æ©Ÿ | ç”¨é€” |
|------|----------|------|
| `onMounted` | çµ„ä»¶é¦–æ¬¡æ›è¼‰ | åˆå§‹æ•¸æ“šè¼‰å…¥ |
| `onActivated` | keep-alive çµ„ä»¶æ¿€æ´» | è¿”å›é é¢æ™‚åˆ·æ–° |
| `onUnmounted` | çµ„ä»¶å¸è¼‰ | æ¸…ç†äº‹ä»¶ç›£è½å™¨ |

### Visibility API

- `document.hidden`: é é¢æ˜¯å¦éš±è—ï¼ˆBooleanï¼‰
- `visibilitychange` äº‹ä»¶: é é¢å¯è¦‹æ€§æ”¹è®Šæ™‚è§¸ç™¼
- ç”¨é€”: æª¢æ¸¬ç”¨æˆ¶åˆ‡æ›æ¨™ç±¤ã€æœ€å°åŒ–è¦–çª—ç­‰æ“ä½œ

## ğŸ” é™¤éŒ¯å»ºè­°

å¦‚æœé¤˜é¡ä»æœªæ›´æ–°ï¼š

1. **æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°**:
   ```
   Dashboard mounted
   Dashboard activated, refreshing data...
   Page became visible, refreshing data...
   ```

2. **æª¢æŸ¥ Network æ¨™ç±¤**: ç¢ºèª `/api/v1/membership/me` è«‹æ±‚è¿”å›æœ€æ–°æ•¸æ“š

3. **æ¸…é™¤ç€è¦½å™¨ç·©å­˜**: Ctrl+Shift+R (ç¡¬åˆ·æ–°)

4. **æª¢æŸ¥å¾Œç«¯æ•¸æ“š**: 
   ```sql
   SELECT id, username, cash, credit FROM users WHERE username = 'free_user';
   ```

5. **æª¢æŸ¥ API éŸ¿æ‡‰**:
   ```bash
   bash /home/ubuntu/QuantLab/test_membership_refresh.sh
   ```

## ğŸ“ ä¿®æ”¹æª”æ¡ˆ

- âœ… `frontend/pages/login.vue` - æ›´æ”¹ç™»å…¥é‡å®šå‘é‚è¼¯
- âœ… `frontend/pages/dashboard/index.vue` - æ–°å¢åˆ·æ–°æ©Ÿåˆ¶
- âœ… `test_membership_refresh.sh` - API æ¸¬è©¦è…³æœ¬

## ğŸš€ éƒ¨ç½²ç‹€æ…‹

- [x] ä¿®æ”¹ä»£ç¢¼
- [x] å‰ç«¯æœå‹™é‡å•Ÿ
- [x] å¾Œç«¯æœå‹™æ­£å¸¸é‹è¡Œ
- [x] API æ¸¬è©¦é€šé
- [ ] ç”Ÿç”¢ç’°å¢ƒé©—è­‰

---

**ä¿®å¾©æ—¥æœŸ**: 2025-12-11  
**ç‰ˆæœ¬**: v1.0  
**ç‹€æ…‹**: âœ… å·²ä¿®å¾©ä¸¦æ¸¬è©¦
