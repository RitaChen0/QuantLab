

Qlib + RD_Agent 

  - æ”¯æ´æ›´å¤šè¡¨é”å¼ï¼ˆRSI, MACD, Bollinger Bands ç­‰ï¼‰
  - å›æ¸¬çµæœè¦–è¦ºåŒ–ï¼ˆè¡¨é”å¼å€¼åœ–è¡¨ï¼‰

  - èª¿æ•´æ¨¡å‹åƒæ•¸ä»¥å„ªåŒ–ç¸¾æ•ˆ
  - æ–°å¢å…¶ä»– ML æ¨¡å‹ï¼ˆå¦‚ XGBoostã€LSTMï¼‰
  - å¯¦ä½œ MLflow å¯¦é©—è¿½è¹¤
  - æ“´å±•æ›´å¤šæŠ€è¡“æŒ‡æ¨™


  ğŸ¤– AI ç­–ç•¥æ•´åˆæ–¹æ¡ˆ

  1ï¸âƒ£ AI ç­–ç•¥ç”Ÿæˆå™¨ï¼ˆç¨‹å¼ç¢¼ç”Ÿæˆï¼‰

  æœ€ç›´æ¥çš„åšæ³•ï¼Œè®“ AI æ ¹æ“šç”¨æˆ¶æè¿°è‡ªå‹•ç”Ÿæˆå›æ¸¬ç­–ç•¥ä»£ç¢¼ï¼š

  å¯¦ä½œæ–¹å¼ï¼š
  # ç”¨æˆ¶è¼¸å…¥ï¼šã€Œæˆ‘æƒ³åšå‡ç·šäº¤å‰ç­–ç•¥ï¼Œ5æ—¥ç·šä¸Šç©¿20æ—¥ç·šè²·å…¥ã€
  # AI ç”Ÿæˆ Backtrader ç­–ç•¥ä»£ç¢¼

  import backtrader as bt

  class MAStrategy(bt.Strategy):
      params = (('fast', 5), ('slow', 20))

      def __init__(self):
          self.fast_ma = bt.indicators.SMA(period=self.params.fast)
          self.slow_ma = bt.indicators.SMA(period=self.params.slow)
          self.crossover = bt.indicators.CrossOver(self.fast_ma, self.slow_ma)

      def next(self):
          if self.crossover > 0:  # é»ƒé‡‘äº¤å‰
              self.buy()
          elif self.crossover < 0:  # æ­»äº¡äº¤å‰
              self.sell()

  æŠ€è¡“å¯¦ç¾ï¼š
  - OpenAI GPT-4ï¼šæ“…é•·ç¨‹å¼ç¢¼ç”Ÿæˆï¼Œæ”¯æ´ function calling
  - Claude 3.5 Sonnetï¼šæ›´å¥½çš„æ¨ç†èƒ½åŠ›ï¼Œé©åˆè¤‡é›œç­–ç•¥
  - æç¤ºè©æ¨¡æ¿ï¼šåŒ…å« Backtrader API æ–‡æª”ã€å¸¸ç”¨æŒ‡æ¨™ã€å®‰å…¨è¦ç¯„

  ---
  2ï¸âƒ£ AI åƒæ•¸å„ªåŒ–å»ºè­°

  åˆ†ææ­·å²å›æ¸¬çµæœï¼Œå»ºè­°æœ€ä½³åƒæ•¸çµ„åˆï¼š

  å¯¦ä½œæ–¹å¼ï¼š
  # è¼¸å…¥ï¼šç­–ç•¥ä»£ç¢¼ + éå» 100 æ¬¡å›æ¸¬çµæœ
  # AI è¼¸å‡ºï¼šã€Œå»ºè­°å°‡ RSI é–¾å€¼å¾ 30/70 èª¿æ•´ç‚º 25/75ï¼Œ
  #          åœæé»å¾ 2% æé«˜åˆ° 3%ï¼Œé æœŸå ±é…¬ç‡æå‡ 15%ã€

  æŠ€è¡“æ¶æ§‹ï¼š
  - ä½¿ç”¨ LangChain ä¸²æ¥å¤šå€‹ AI å·¥å…·
  - æ•´åˆ å›æ¸¬çµæœåˆ†æï¼šå‹ç‡ã€å ±é…¬ç‡ã€æœ€å¤§å›æ’¤
  - ä½¿ç”¨ Optuna é€²è¡Œåƒæ•¸æœç´¢ï¼ŒAI è§£é‡‹æœ€ä½³åƒæ•¸èƒŒå¾Œé‚è¼¯

  ---
  3ï¸âƒ£ AI äº¤æ˜“ä¿¡è™Ÿè¼”åŠ©

  çµåˆæŠ€è¡“æŒ‡æ¨™ + æ–°èæƒ…ç·’ + AI åˆ¤æ–·ï¼š

  å¯¦ä½œæ–¹å¼ï¼š
  # å¤šæ¨¡æ…‹è¼¸å…¥ï¼š
  # 1. æŠ€è¡“æŒ‡æ¨™æ•¸æ“šï¼ˆRSIã€MACDã€æˆäº¤é‡ï¼‰
  # 2. æ–°èæ¨™é¡Œçˆ¬èŸ²ï¼ˆã€Œå°ç©é›»ç²å¤§å–®ã€ï¼‰
  # 3. è²¡å ±æ•¸æ“šï¼ˆç‡Ÿæ”¶å¹´å¢ç‡ 20%ï¼‰

  # AI è¼¸å‡ºï¼š
  # "ç¶œåˆæŠ€è¡“é¢é»ƒé‡‘äº¤å‰ + åŸºæœ¬é¢åˆ©å¤šï¼Œå»ºè­°è²·å…¥ï¼Œä¿¡å¿ƒåº¦ 85%"

  æŠ€è¡“å¯¦ç¾ï¼š
  - æƒ…ç·’åˆ†æï¼šä½¿ç”¨ FinBERT æˆ– GPT-4 åˆ†æè²¡ç¶“æ–°è
  - RAG æ¶æ§‹ï¼šå‘é‡æ•¸æ“šåº«å­˜å„²æ­·å²æ–°èèˆ‡è‚¡åƒ¹é—œè¯
  - å¤šå› å­æ¨¡å‹ï¼šAI å‹•æ…‹èª¿æ•´å› å­æ¬Šé‡

  ---
  4ï¸âƒ£ è‡ªç„¶èªè¨€ç­–ç•¥ç·¨è¼¯å™¨

  è®“éæŠ€è¡“ç”¨æˆ¶ç”¨å°è©±æ–¹å¼å»ºç«‹ç­–ç•¥ï¼š

  ç”¨æˆ¶é«”é©—ï¼š
  ç”¨æˆ¶ï¼š"ç•¶å°ç©é›»è·Œç ´5æ—¥å‡ç·šæ™‚è³£å‡º"
  AIï¼šã€Œæˆ‘å¹«ä½ æ·»åŠ äº†é€™å€‹æ¢ä»¶ï¼Œéœ€è¦è¨­å®šåœæé»å—ï¼Ÿã€
  ç”¨æˆ¶ï¼š"æ˜¯çš„ï¼Œè·Œç ´ 3% å°±åœæ"
  AIï¼šã€Œç­–ç•¥å·²æ›´æ–°ï¼Œè¦ç«‹å³å›æ¸¬å—ï¼Ÿã€

  æŠ€è¡“å¯¦ç¾ï¼š
  - Conversational Agentï¼šä½¿ç”¨ LangChain Agent æ¡†æ¶
  - ç‹€æ…‹ç®¡ç†ï¼šè¿½è¹¤å¤šè¼ªå°è©±ä¸Šä¸‹æ–‡
  - ç­–ç•¥ DSLï¼šå°‡è‡ªç„¶èªè¨€è½‰æ›ç‚ºçµæ§‹åŒ–ç­–ç•¥æè¿°

  ---
  ğŸ› ï¸ é‡å° QuantLab çš„å…·é«”å¯¦ä½œå»ºè­°

  åŸºæ–¼ä½ ç›®å‰çš„æ¶æ§‹ï¼Œæˆ‘å»ºè­°åˆ†éšæ®µå¯¦ä½œï¼š

  Phase 1ï¼šAI ç­–ç•¥ç”Ÿæˆå™¨ï¼ˆæœ€å¿«è¦‹æ•ˆï¼‰

  # æ–°å¢ API ç«¯é»
  POST /api/v1/ai/generate-strategy
  {
    "description": "RSI è¶…è³£è²·å…¥ï¼Œè¶…è²·è³£å‡º",
    "stocks": ["2330", "2454"],
    "timeframe": "daily"
  }

  # å›å‚³ç”Ÿæˆçš„ç­–ç•¥ä»£ç¢¼ + è§£é‡‹

  éœ€è¦æ–°å¢çš„æ¨¡çµ„ï¼š
  - app/services/ai_service.pyï¼šèª¿ç”¨ OpenAI/Claude API
  - app/api/v1/ai.pyï¼šAI ç›¸é—œç«¯é»
  - æç¤ºè©æ¨¡æ¿åº«ï¼šapp/prompts/strategy_generation.py

  ---
  Phase 2ï¼šç­–ç•¥æ€§èƒ½åˆ†æ

  POST /api/v1/ai/analyze-backtest
  {
    "backtest_id": 123
  }

  # AI åˆ†æå›æ¸¬çµæœï¼Œçµ¦å‡ºæ”¹é€²å»ºè­°

  ---
  Phase 3ï¼šå°è©±å¼ç­–ç•¥ç·¨è¼¯å™¨

  - å‰ç«¯é›†æˆèŠå¤©ç•Œé¢ï¼ˆé¡ä¼¼ ChatGPTï¼‰
  - WebSocket å¯¦æ™‚å°è©±
  - ç­–ç•¥å³æ™‚é è¦½èˆ‡ä¿®æ”¹

  ---
  ğŸ“š åƒè€ƒæ¡ˆä¾‹

  1. QuantConnect LEANï¼šæ”¯æ´ AI é©…å‹•çš„ Alpha ç”Ÿæˆ
  2. Alpaca AutoTraderï¼šGPT-4 ç”Ÿæˆäº¤æ˜“é‚è¼¯
  3. TradingView Pine Script AIï¼šè‡ªç„¶èªè¨€è½‰ç­–ç•¥ä»£ç¢¼
  4. Bloomberg Terminal GPTï¼šè²¡ç¶“æ–°èæƒ…ç·’åˆ†æ



æ•´åˆ Shioaji

â— æ ¹æ“š QuantLab ç¾æœ‰æ¶æ§‹ï¼Œæˆ‘å»ºè­°æ¡ç”¨åˆ†å±¤å­˜å„² + ç”¨é€”åˆ†é›¢çš„ç­–ç•¥ã€‚ä»¥ä¸‹æ˜¯è©³ç´°åˆ†æï¼š

  ğŸ“Š è³‡æ–™ç‰¹æ€§å°æ¯”

  | ç¶­åº¦   | æ—¥ç·šè³‡æ–™ (FinLab)             | åˆ†é˜ç·šè³‡æ–™ (Shioaji)                       |
  |------|---------------------------|---------------------------------------|
  | è³‡æ–™é‡  | ~2,671 æª” Ã— 10 å¹´ â‰ˆ 1000 è¬ç­† | ~2,671 æª” Ã— 270 åˆ†/æ—¥ Ã— 250 å¤© â‰ˆ 1.8 å„„ç­†/å¹´ |
  | æ›´æ–°é »ç‡ | æ¯æ—¥æ”¶ç›¤å¾Œ                     | å³æ™‚ or æ¯åˆ†é˜                             |
  | é©ç”¨å ´æ™¯ | é•·æœŸç­–ç•¥ã€åŸºæœ¬é¢åˆ†æ                | æ—¥å…§äº¤æ˜“ã€é«˜é »ç­–ç•¥                             |
  | å­˜å„²æˆæœ¬ | ä½ï¼ˆç›®å‰ç´„ 500MBï¼‰              | é«˜ï¼ˆé ä¼° 10-50GB/å¹´ï¼‰                       |

  ğŸ¯ æ¨è–¦æ–¹æ¡ˆï¼šæ··åˆæ¶æ§‹

  1. è³‡æ–™è¡¨è¨­è¨ˆï¼ˆTimescaleDB hypertableï¼‰

  -- åˆ†é˜ç·šè³‡æ–™è¡¨ï¼ˆä½¿ç”¨ TimescaleDB æ™‚åºè³‡æ–™åº«ï¼‰
  CREATE TABLE stock_minute_prices (
      time TIMESTAMPTZ NOT NULL,           -- æ™‚é–“æˆ³ï¼ˆç²¾ç¢ºåˆ°åˆ†é˜ï¼‰
      stock_id VARCHAR(10) NOT NULL,       -- è‚¡ç¥¨ä»£ç¢¼
      open NUMERIC(10, 2),
      high NUMERIC(10, 2),
      low NUMERIC(10, 2),
      close NUMERIC(10, 2),
      volume BIGINT,
      source VARCHAR(20) DEFAULT 'shioaji', -- è³‡æ–™ä¾†æºæ¨™è¨˜
      PRIMARY KEY (time, stock_id)
  );

  -- è½‰æ›ç‚º TimescaleDB hypertableï¼ˆè‡ªå‹•åˆ†å€ï¼‰
  SELECT create_hypertable('stock_minute_prices', 'time');

  -- è¨­å®šè³‡æ–™ä¿ç•™æ”¿ç­–ï¼ˆä¾‹å¦‚åªä¿ç•™æœ€è¿‘ 3 å€‹æœˆï¼‰
  SELECT add_retention_policy('stock_minute_prices', INTERVAL '90 days');

  å„ªé»ï¼š
  - TimescaleDB å·²åœ¨ç³»çµ±ä¸­ï¼ˆdocker-compose.yml:9 ä½¿ç”¨ timescale/timescaledb:latest-pg15ï¼‰
  - è‡ªå‹•æ™‚é–“åˆ†å€ï¼ŒæŸ¥è©¢æ•ˆèƒ½ä½³
  - å…§å»ºå£“ç¸®åŠŸèƒ½ï¼ˆå¯ç¯€çœ 90% å­˜å„²ç©ºé–“ï¼‰
  - è‡ªå‹•è³‡æ–™ä¿ç•™æ”¿ç­–ï¼ˆèˆŠè³‡æ–™è‡ªå‹•åˆªé™¤ï¼‰

  2. è³‡æ–™åŒæ­¥ç­–ç•¥

  # backend/app/tasks/shioaji_sync.py

  @celery_app.task(bind=True, name="app.tasks.sync_minute_prices")
  def sync_minute_prices(self: Task, stock_ids: list[str], date: str) -> dict:
      """
      åŒæ­¥åˆ†é˜ç·šè³‡æ–™ï¼ˆæ­·å²è³‡æ–™è£œé½Šï¼‰
      
      Args:
          stock_ids: è‚¡ç¥¨ä»£ç¢¼åˆ—è¡¨
          date: æ—¥æœŸ (YYYY-MM-DD)
      """
      # ä½¿ç”¨ Shioaji API ç²å–æ­·å²åˆ†é˜ç·š
      # æ‰¹æ¬¡å¯«å…¥ TimescaleDB
      pass

  @celery_app.task(bind=True, name="app.tasks.sync_realtime_minute_prices")
  def sync_realtime_minute_prices(self: Task) -> dict:
      """
      åŒæ­¥å³æ™‚åˆ†é˜ç·šè³‡æ–™ï¼ˆåƒ…äº¤æ˜“æ™‚æ®µï¼‰
      
      Celery Beat é…ç½®ï¼šæ¯ 1 åˆ†é˜åŸ·è¡Œä¸€æ¬¡ï¼ˆ9:00-13:30ï¼‰
      """
      pass

  å»ºè­°åŒæ­¥ç­–ç•¥ï¼š
  - æ­·å²è³‡æ–™ï¼šä¸€æ¬¡æ€§æ‰¹æ¬¡åŒ¯å…¥ï¼ˆéå» 3-6 å€‹æœˆï¼‰
  - å³æ™‚è³‡æ–™ï¼šäº¤æ˜“æ™‚æ®µæ¯åˆ†é˜åŒæ­¥ï¼ˆåƒ…ç†±é–€è‚¡ç¥¨ï¼Œå¦‚å°ç©é›»ã€é´»æµ·ç­‰å‰ 50 å¤§ï¼‰
  - å…¨å¸‚å ´è³‡æ–™ï¼šæ”¶ç›¤å¾Œæ‰¹æ¬¡åŒæ­¥ç•¶æ—¥åˆ†é˜ç·šï¼ˆæ‰€æœ‰è‚¡ç¥¨ï¼‰

  3. Qlib åˆ†é˜ç·šæ”¯æ´

  # backend/app/core/qlib_config.py

  def init_qlib_minute_data():
      """åˆå§‹åŒ– Qlib åˆ†é˜ç·šå¼•æ“"""
      import qlib
      from qlib.config import C

      qlib.init(
          provider_uri="/data/qlib/tw_stock_minute",  # åˆ†é˜ç·šè³‡æ–™è·¯å¾‘
          region="cn",  # ä½¿ç”¨ä¸­åœ‹æ—¥æ›†ï¼ˆæœ€æ¥è¿‘å°è‚¡ï¼‰
          freq="1min",  # åˆ†é˜ç·šé »ç‡ âœ…
          expression_cache=None,
          dataset_cache=None,
      )

  Qlib è³‡æ–™è½‰æ›ï¼š
  # å°‡ TimescaleDB åˆ†é˜ç·šåŒ¯å‡ºç‚º Qlib æ ¼å¼
  docker compose exec backend python scripts/export_minute_to_qlib.py \
    --output-dir /data/qlib/tw_stock_minute \
    --freq 1min

  4. API ç«¯é»è¨­è¨ˆ

  # backend/app/api/v1/data.py

  @router.get("/minute-price/{stock_id}")
  async def get_minute_price(
      stock_id: str,
      start_date: str,
      end_date: str,
      interval: int = 1,  # 1, 5, 15, 30, 60 åˆ†é˜
      current_user: User = Depends(get_current_user),
  ):
      """
      ç²å–åˆ†é˜ç·šè³‡æ–™
      
      Args:
          interval: K ç·šé€±æœŸï¼ˆ1/5/15/30/60 åˆ†é˜ï¼‰
      """
      # æŸ¥è©¢ stock_minute_prices
      # æ ¹æ“š interval é€²è¡Œèšåˆï¼ˆresampleï¼‰
      pass

  5. å›æ¸¬å¼•æ“æ•´åˆ

  # backend/app/services/qlib_backtest_engine.py

  class QlibBacktestEngine:
      def run_backtest(
          self,
          strategy_code: str,
          freq: str = "day",  # "day" or "1min" âœ…
          **kwargs
      ):
          if freq == "1min":
              # åˆ‡æ›åˆ°åˆ†é˜ç·š Qlib å¼•æ“
              init_qlib_minute_data()
          else:
              # ä½¿ç”¨æ—¥ç·š Qlib å¼•æ“
              init_qlib()

          # åŸ·è¡Œå›æ¸¬...

  âš–ï¸ æ–¹æ¡ˆæ¯”è¼ƒ

  | æ–¹æ¡ˆ                 | å„ªé»        | ç¼ºé»       | é©ç”¨å ´æ™¯      |
  |--------------------|-----------|----------|-----------|
  | A. å…¨éƒ¨å­˜ TimescaleDB | çµ±ä¸€ç®¡ç†ã€æŸ¥è©¢éˆæ´» | å­˜å„²æˆæœ¬é«˜    | éœ€è¦æ­·å²åˆ†é˜ç·šå›æ¸¬ |
  | B. åƒ…å­˜æœ€è¿‘ N å¤©        | æˆæœ¬ä½ã€æ•ˆèƒ½ä½³   | ç„¡æ³•å›æ¸¬é•·æœŸç­–ç•¥ | åªåšæ—¥å…§äº¤æ˜“    |
  | C. æ—¥ç·š + åˆ†é˜ç·šæ··åˆ      | å¹³è¡¡æˆæœ¬èˆ‡åŠŸèƒ½   | æ¶æ§‹è¼ƒè¤‡é›œ    | æ¨è–¦æ–¹æ¡ˆ âœ…    |

  ğŸš€ å¯¦ä½œå„ªå…ˆé †åº

  Phase 1ï¼šåŸºç¤è¨­æ–½ï¼ˆ1-2 é€±ï¼‰

  1. âœ… å»ºç«‹ stock_minute_prices TimescaleDB hypertable
  2. âœ… å¯¦ä½œ Shioaji API å®¢æˆ¶ç«¯ï¼ˆapp/services/shioaji_client.pyï¼‰
  3. âœ… æ–°å¢ Alembic é·ç§»è…³æœ¬

  Phase 2ï¼šè³‡æ–™åŒæ­¥ï¼ˆ2-3 é€±ï¼‰

  4. âœ… å¯¦ä½œæ­·å²åˆ†é˜ç·šæ‰¹æ¬¡åŒæ­¥ä»»å‹™
  5. âœ… å¯¦ä½œå³æ™‚åˆ†é˜ç·šåŒæ­¥ä»»å‹™ï¼ˆCelery Beatï¼‰
  6. âœ… è¨­å®šè³‡æ–™ä¿ç•™æ”¿ç­–ï¼ˆä¿ç•™ 90 å¤©ï¼‰

  Phase 3ï¼šå›æ¸¬æ•´åˆï¼ˆ2-3 é€±ï¼‰

  7. âœ… å°‡åˆ†é˜ç·šåŒ¯å‡ºç‚º Qlib v2 æ ¼å¼
  8. âœ… æ”¯æ´åˆ†é˜ç·šå›æ¸¬ï¼ˆBacktrader + Qlibï¼‰
  9. âœ… å‰ç«¯æ–°å¢ã€Œæ™‚é–“ç²’åº¦ã€é¸æ“‡å™¨

  Phase 4ï¼šæœ€ä½³åŒ–ï¼ˆé¸é…ï¼‰

  10. â­ TimescaleDB å£“ç¸®ï¼ˆç¯€çœ 90% ç©ºé–“ï¼‰
  11. â­ å³æ™‚ WebSocket æ¨é€ï¼ˆäº¤æ˜“æ™‚æ®µï¼‰
  12. â­ åˆ†é˜ç·šæŠ€è¡“æŒ‡æ¨™å¿«å–

  ğŸ’¡ é—œéµæ±ºç­–å»ºè­°

  1. å­˜å„²ç­–ç•¥ï¼šä½¿ç”¨ TimescaleDB è‡ªå‹•åˆ†å€ + å£“ç¸® + ä¿ç•™æ”¿ç­–
  2. åŒæ­¥ç­–ç•¥ï¼šæ­·å²æ‰¹æ¬¡ + å³æ™‚å¢é‡ï¼ˆåƒ…ç†±é–€è‚¡ï¼‰
  3. è³‡æ–™ä¿ç•™ï¼šåˆ†é˜ç·šä¿ç•™ 3-6 å€‹æœˆï¼Œæ—¥ç·šæ°¸ä¹…ä¿ç•™
  4. å›æ¸¬å¼•æ“ï¼šQlib æ”¯æ´æ—¥ç·š/åˆ†é˜ç·šåˆ‡æ›
  5. ç›£æ§é‡é»ï¼šTimescaleDB ç£ç¢Ÿç”¨é‡ã€Shioaji API é…é¡

  éœ€è¦æˆ‘å”åŠ©å¯¦ä½œå“ªå€‹éƒ¨åˆ†å—ï¼Ÿä¾‹å¦‚ï¼š
  - å»ºç«‹è³‡æ–™è¡¨é·ç§»è…³æœ¬
  - å¯¦ä½œ Shioaji API å®¢æˆ¶ç«¯
  - è¨­å®š Celery åŒæ­¥ä»»å‹™
