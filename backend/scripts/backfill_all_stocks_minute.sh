#!/bin/bash
# è£œé½Šæ‰€æœ‰è‚¡ç¥¨çš„ 12/19-12/24 åˆ†é˜ç·šæ•¸æ“š
#
# ä½¿ç”¨æ–¹å¼:
#   bash scripts/backfill_all_stocks_minute.sh
#
# é è¨ˆæ™‚é–“ï¼š2,671 æª”è‚¡ç¥¨ Ã— 2 ç§’/æª” â‰ˆ 90 åˆ†é˜

set -e

echo "=========================================="
echo "è£œé½Šæ‰€æœ‰è‚¡ç¥¨çš„ 12/19-12/24 åˆ†é˜ç·šæ•¸æ“š"
echo "=========================================="
echo ""

# é€²å…¥ backend ç›®éŒ„
cd "$(dirname "$0")/.."

echo "ğŸ“Š é è¨ˆè£œé½Šç¯„åœï¼š"
echo "  - æ—¥æœŸ: 2025-12-19 ~ 2025-12-24"
echo "  - è‚¡ç¥¨: ç´„ 2,671 æª”"
echo "  - é è¨ˆæ™‚é–“: ç´„ 90 åˆ†é˜"
echo ""

read -p "æ˜¯å¦ç¹¼çºŒï¼Ÿ(y/N) " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]
then
    echo "âŒ å·²å–æ¶ˆ"
    exit 1
fi

echo ""
echo "ğŸš€ é–‹å§‹åŒæ­¥..."
echo ""

# ä½¿ç”¨ docker compose exec åŸ·è¡ŒåŒæ­¥
# --start-date å’Œ --end-date æ¨¡å¼æœƒåŒæ­¥æ‰€æœ‰è‚¡ç¥¨
docker compose exec backend python /app/scripts/sync_shioaji_to_qlib.py \
    --start-date 2025-12-19 \
    --end-date 2025-12-24

echo ""
echo "=========================================="
echo "âœ… è£œé½Šå®Œæˆï¼"
echo "=========================================="
