# 📊 模型预测完整使用指南

## 🎉 新功能上线

现在你可以使用训练好的 RD-Agent 模型进行智能预测！

---

## 📍 访问路径

### 方法 1：从 RD-Agent 主页访问（推荐）

```
1. 访问 http://122.116.152.55
2. 登录系统
3. 点击左侧菜单「自動研發」
4. 切换到「生成的模型」标签页
5. 找到你的模型卡片
6. 点击绿色的「📊 模型預測」按钮
```

**模型卡片界面说明**：
```
┌─────────────────────────────────────────────┐
│ 模型名称                    [TimeSeries]    │
│                            [✅ 已訓練]       │
│ 2025-12-30                                  │
├─────────────────────────────────────────────┤
│ 描述：台指期货短期预测模型...               │
│                                             │
│ Sharpe: 0.52  年化报酬: 12.5%  回撤: -8.3% │
├─────────────────────────────────────────────┤
│ [🎯 訓練模型]  [📊 模型預測]              │
└─────────────────────────────────────────────┘
```

### 方法 2：直接访问 URL

```
http://122.116.152.55/rdagent/models/{模型ID}/predict
```

**示例**：
- 模型 ID 为 1：`http://122.116.152.55/rdagent/models/1/predict`
- 模型 ID 为 2：`http://122.116.152.55/rdagent/models/2/predict`

---

## 🎨 界面功能详解

### 左侧：预测配置面板

#### 1. 选择股票

**预设组（一键选择）**：
- 🔥 **热门股票**：2330, 2317, 2454, 2308, 2412
- 📈 **期货**：TXCONT, MTXCONT
- 💻 **科技股**：2330, 2454, 3008, 2382, 6505

**手动输入**：
- 输入任意股票代码（如：2330）
- 按回车或点击「添加」按钮
- 支持多选，可添加任意多支股票

**已选股票管理**：
- 蓝色标签显示已选股票
- 点击 ✕ 即可移除

#### 2. 预测日期范围

**自定义日期**：
- 开始日期：选择预测起始日
- 结束日期：选择预测结束日

**快捷按钮**：
- 最近 7 天
- 最近 30 天
- 最近 90 天

#### 3. 交易信号阈值

**买入阈值**（默认 0.02）：
- 当预测值 > 0.02 时，生成买入信号
- 建议范围：0.01 - 0.05

**卖出阈值**（默认 -0.02）：
- 当预测值 < -0.02 时，生成卖出信号
- 建议范围：-0.05 - -0.01

**阈值调整建议**：
- **激进交易**：买入 0.01，卖出 -0.01（信号多，频繁交易）
- **稳健交易**：买入 0.03，卖出 -0.03（信号少，精准交易）
- **均衡策略**：买入 0.02，卖出 -0.02（推荐）

#### 4. 生成预测按钮

- 点击「🚀 生成预测」
- 等待 3-10 秒（取决于股票数量和日期范围）
- 显示实时进度反馈

---

### 右侧：预测结果展示

#### 1. 汇总统计卡片

显示所有股票的汇总数据：

```
┌──────────┬──────────┬──────────┬──────────┐
│ 总预测   │  买入    │  卖出    │  平均    │
│  天数    │  信号    │  信号    │  预测值  │
├──────────┼──────────┼──────────┼──────────┤
│   93     │   24     │    8     │ +0.0124  │
│          │ 25.8%    │  8.6%    │          │
└──────────┴──────────┴──────────┴──────────┘
```

**指标解读**：
- **买入信号占比 > 20%**：模型偏向看多
- **卖出信号占比 > 20%**：模型偏向看空
- **平均预测值 > 0**：整体趋势向上

#### 2. 各股票详细预测

**折叠/展开**：
- 点击股票标题可展开/折叠详情
- 默认展开第一支股票

**预测图表**（Chart.js）：
- 📈 蓝色折线：预测值走势
- 🟢 绿色虚线：买入阈值（水平线）
- 🔴 红色虚线：卖出阈值（水平线）
- 🎨 背景颜色：绿色区域（买入）、红色区域（卖出）

**预测表格**：
| 日期 | 预测值 | 信号 | 操作建议 |
|------|--------|------|---------|
| 2024-12-30 | +0.0345 | 买入 | 建议买入 |
| 2024-12-29 | -0.0123 | 持有 | 观望 |
| 2024-12-28 | +0.0521 | 买入 | 建议买入 |

**颜色编码**：
- 🟢 **绿色行**：买入信号日
- 🔴 **红色行**：卖出信号日
- ⚪ **白色行**：持有观望

#### 3. 导出功能

每支股票都可以独立导出为 CSV 文件：
- 点击「📥 导出 CSV」按钮
- 自动下载文件：`{股票代码}_predictions.csv`
- 包含完整预测数据和信号

**CSV 格式**：
```csv
Date,Prediction,Signal,Action
2024-12-30,0.0345,1,建议买入
2024-12-29,-0.0123,0,观望
2024-12-28,0.0521,1,建议买入
```

---

## 🎯 实战使用流程

### 场景 1：台指期货日内交易

```
目标：预测台指期货未来 7 天走势

步骤：
1. 选择股票：点击「期货」预设 → TXCONT
2. 日期范围：点击「最近 7 天」
3. 阈值设置：买入 0.02，卖出 -0.02
4. 生成预测
5. 分析结果：
   - 查看买入信号占比
   - 展开 TXCONT 查看详细图表
   - 根据预测值决定开仓方向
```

**预期结果**：
- 7 天预测数据
- 2-3 个买入/卖出信号
- 明确的操作建议

---

### 场景 2：批量筛选潜力股

```
目标：从多支股票中找出最有潜力的

步骤：
1. 选择股票：热门股票 + 科技股（10支）
2. 日期范围：最近 30 天
3. 生成预测
4. 对比分析：
   - 查看各股票的买入信号数量
   - 比较平均预测值
   - 选出买入信号 > 5 且平均预测值 > 0.02 的股票
```

**预期结果**：
- 筛选出 2-3 支高潜力股票
- 明确的交易时机

---

### 场景 3：验证模型质量

```
目标：评估模型预测准确性

步骤：
1. 选择历史时间段（如 2024-11-01 至 2024-11-30）
2. 生成预测
3. 导出 CSV
4. 与实际价格对比：
   - 买入信号日的次日涨跌
   - 计算预测准确率
   - 调整阈值优化信号
```

**评估指标**：
- 买入信号胜率 > 55%：合格
- 买入信号胜率 > 65%：优秀
- 买入信号胜率 > 75%：卓越

---

## 📊 预测结果解读

### 1. 预测值的含义

预测值表示**下一期的预期收益率**（通常是下一个交易日）。

**示例**：
- 预测值 = +0.0345
- 含义：预测下一交易日上涨 3.45%

**预测值范围**：
- `> +0.05`：强烈看多 ⭐⭐⭐⭐⭐
- `+0.02 ~ +0.05`：看多 ⭐⭐⭐⭐
- `-0.02 ~ +0.02`：中性 ⭐⭐⭐
- `-0.05 ~ -0.02`：看空 ⭐⭐
- `< -0.05`：强烈看空 ⭐

### 2. 信号分布健康度

**理想分布**（避免过度交易）：
```
买入信号：10-20%
持有信号：60-80%
卖出信号：10-20%
```

**不健康分布**：
- 买入 > 40%：模型过度乐观，可能误判
- 买入 < 5%：阈值过高，错过机会
- 卖出 > 40%：模型过度悲观

### 3. 模型 IC (Information Coefficient)

在模型标题下方显示：`测试 IC: 0.0523`

**IC 评级**：
- `> 0.05`：优秀 ⭐⭐⭐⭐⭐（强预测能力）
- `0.03 - 0.05`：良好 ⭐⭐⭐⭐（可用）
- `0.01 - 0.03`：一般 ⭐⭐⭐（需优化）
- `< 0.01`：差 ⭐（重新训练）

---

## ⚙️ 高级用法

### 1. 阈值优化

**目标**：找到最佳买卖阈值

```python
# 伪代码：批量测试不同阈值
for buy_threshold in [0.01, 0.02, 0.03, 0.05]:
    for sell_threshold in [-0.01, -0.02, -0.03, -0.05]:
        predictions = generate(buy_threshold, sell_threshold)
        win_rate = calculate_win_rate(predictions)
        print(f"阈值 {buy_threshold}/{sell_threshold}: 胜率 {win_rate}%")
```

**手动操作**：
1. 使用默认阈值生成预测并记录结果
2. 调整为 0.03/-0.03 再次生成
3. 对比两次的信号数量和分布
4. 选择最优参数

### 2. 组合多模型预测

如果你训练了多个模型：

```
步骤：
1. 对模型 1 生成预测 → 导出 CSV
2. 对模型 2 生成预测 → 导出 CSV
3. 合并 CSV 文件
4. 取信号一致的日期作为最终信号
```

**集成策略**：
- 2 个模型都预测买入 → 强买入
- 1 个买入 1 个持有 → 谨慎买入
- 2 个模型预测相反 → 观望

### 3. 实时预测自动化

**使用 API**：
```bash
# 每天自动生成预测
curl -X POST "http://122.116.152.55/api/v1/rdagent/models/1/predict" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "symbols": ["TXCONT"],
    "start_date": "2024-12-30",
    "end_date": "2024-12-30",
    "buy_threshold": 0.02
  }' | jq '.predictions[0].signals | to_entries | .[] | select(.value == 1)'
```

**定时任务**（crontab）：
```bash
# 每天 14:30 生成次日预测
30 14 * * * /home/user/daily_predict.sh
```

---

## 🔍 常见问题

### Q1: 模型显示"未训练"，无法预测？

**解决方案**：
1. 点击「🎯 訓練模型」按钮
2. 配置训练参数（使用 Alpha158 推荐）
3. 等待 10-15 分钟训练完成
4. 返回预测页面

### Q2: 预测结果没有买入/卖出信号？

**原因**：
- 阈值设置过高
- 预测值都在中性区间

**解决方案**：
- 降低阈值：0.02 → 0.01
- 查看平均预测值，如果接近 0，说明模型认为市场中性

### Q3: 预测生成失败？

**可能原因**：
1. 模型尚未训练完成 → 检查训练状态
2. 日期范围没有数据 → 选择最近日期
3. 股票代码错误 → 检查输入

**解决方案**：
- 查看浏览器控制台（F12）
- 检查网络请求错误信息
- 联系管理员

### Q4: 如何判断预测是否准确？

**验证方法**：
1. 使用历史数据回测（如 11 月数据）
2. 导出预测 CSV
3. 对比实际涨跌
4. 计算胜率

**胜率计算**：
```
胜率 = 正确信号数 / 总信号数 × 100%

示例：
- 买入信号 10 次
- 次日实际上涨 7 次
- 胜率 = 7/10 = 70%
```

---

## 📈 最佳实践

### ✅ 推荐做法

1. **训练前验证数据**
   - 确保使用 Alpha158（179个因子）
   - 训练集至少 1 年数据
   - 测试 IC > 0.03 再使用

2. **预测时谨慎筛选**
   - 多选几支股票对比
   - 只交易信号明确的日期
   - 结合技术分析验证

3. **持续优化**
   - 每月重新训练模型
   - 调整阈值适应市场
   - 记录实际交易结果

### ❌ 避免错误

1. **盲目信任预测**
   - 预测只是参考，不是保证
   - 需结合基本面和技术面

2. **过度交易**
   - 阈值过低会产生过多信号
   - 建议买入信号 < 20%

3. **忽视风险控制**
   - 设置止损点
   - 控制仓位大小
   - 分散投资

---

## 🎓 进阶教程

### 回测验证完整流程

```
1. 选择历史时间段（如 2024-11 月）
2. 生成预测并导出 CSV
3. 使用 Python 分析：

import pandas as pd

# 读取预测数据
pred_df = pd.read_csv('TXCONT_predictions.csv')

# 读取实际价格（从数据库或 API）
actual_df = get_actual_prices('TXCONT', '2024-11-01', '2024-11-30')

# 合并数据
merged = pred_df.merge(actual_df, on='Date')

# 计算次日涨跌
merged['actual_return'] = merged['close'].pct_change().shift(-1)

# 买入信号胜率
buy_signals = merged[merged['Signal'] == 1]
win_rate = (buy_signals['actual_return'] > 0).mean()

print(f"买入信号胜率: {win_rate:.1%}")
```

---

## 📞 技术支持

**遇到问题？**
1. 查看本指南常见问题部分
2. 检查浏览器控制台错误
3. 联系技术支持

**反馈建议**：
- 功能改进建议
- Bug 报告
- 新功能需求

---

## 📝 更新日志

**v1.0.0** (2025-12-30)
- ✅ 首次发布模型预测功能
- ✅ 支持批量预测多支股票
- ✅ Chart.js 可视化图表
- ✅ CSV 导出功能
- ✅ 训练状态徽章
- ✅ 实时预测 API

**计划功能**：
- 🔜 预测结果对比（多模型）
- 🔜 自动发送 Telegram 告警
- 🔜 策略回测集成
- 🔜 实时预测更新

---

## 🚀 快速开始

**3 分钟上手**：

```
1. 访问 http://122.116.152.55/rdagent
2. 切换到「生成的模型」
3. 点击「📊 模型預測」
4. 选择「期货」→「最近 30 天」
5. 点击「🚀 生成预测」
6. 查看结果并导出
```

**立即开始你的第一次预测吧！** 🎉
