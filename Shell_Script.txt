================================================================================
âœ… QuantLab ç³»çµ±ç¶­è­·å¿«é€Ÿåƒè€ƒæ‰‹å†Š
================================================================================

ã€ç³»çµ±åŸºæœ¬ä¿¡æ¯ã€‘
- æœå‹™å™¨ IP: 122.116.152.55
- å‰ç«¯: http://122.116.152.55:3000 æˆ– http://localhost:3000
- å¾Œç«¯ API: http://122.116.152.55:8000 æˆ– http://localhost:8000
- æ¸¬è©¦å¸³è™Ÿ: vip_user / test123

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ä¸€ã€‘å¿«é€Ÿé–‹ç™¼å‘½ä»¤
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… é–‹ç™¼éšæ®µæ¸…é™¤æ‰€æœ‰ç·©å­˜
bash scripts/quick-clean.sh              # å¿«é€Ÿæ¸…ç†å‰ç«¯å¿«å–
bash scripts/reset-rate-limit.sh         # é‡ç½®é€Ÿç‡é™åˆ¶
docker compose restart backend celery-worker

âœ… é‡æ–°æ§‹å»ºä¸¦å•Ÿå‹•ï¼ˆç¢ºä¿æ‰€æœ‰è®Šæ›´ç”Ÿæ•ˆï¼‰
docker compose down
docker compose up -d --build

âœ… æŸ¥çœ‹æœå‹™ç‹€æ…‹
docker compose ps
docker compose logs -f backend
docker compose logs -f celery-worker

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€äºŒã€‘æ•¸æ“šç®¡ç†
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… è³‡æ–™åº«å®Œæ•´æ€§æª¢æŸ¥èˆ‡ä¿®å¾©
# å¿«é€Ÿæª¢æŸ¥ï¼ˆæ¨è–¦æ¯æ—¥åŸ·è¡Œï¼‰
bash scripts/db-integrity-check.sh

# æª¢æŸ¥ä¸¦è‡ªå‹•ä¿®å¾©
bash scripts/db-integrity-check.sh --fix

# æ‰‹å‹•è£œé½Šç¼ºå¤±è³‡æ–™
docker compose exec backend python /app/scripts/check_and_fill_gaps.py --auto-fix --min-records 4500

âœ… Qlib æ•¸æ“šåŒæ­¥ï¼ˆæ™ºæ…§å¢é‡ï¼‰
# åŒæ­¥æ‰€æœ‰è‚¡ç¥¨ï¼ˆ1-5 åˆ†é˜ï¼‰
# è£œé½Šå¾ŒåŒæ­¥ Qlib
bash scripts/sync-qlib-smart.sh

# åŒæ­¥å–®ä¸€è‚¡ç¥¨
bash scripts/sync-qlib-smart.sh --stock 2330

# å®Œæ•´é‡æ–°å°å‡ºï¼ˆ30-60 åˆ†é˜ï¼Œå°‘ç”¨ï¼‰
docker compose exec backend python /app/scripts/export_to_qlib_v2.py \
  --output-dir /data/qlib/tw_stock_v2 \
  --stocks all

âœ… Shioaji åˆ†é˜ç·šåŒæ­¥
# æ™ºæ…§å¢é‡åŒæ­¥ï¼ˆæ¨è–¦ï¼‰
docker compose exec backend python /app/scripts/sync_shioaji_to_qlib.py --smart

# åŒæ­¥ä»Šå¤©
docker compose exec backend python /app/scripts/sync_shioaji_to_qlib.py --today

# èƒŒæ™¯åŸ·è¡Œï¼ˆé¿å…æ–·ç·šï¼‰
nohup docker compose exec -T backend python /app/scripts/sync_shioaji_to_qlib.py --smart > /tmp/shioaji_sync.log 2>&1 &

âœ… ä½¿ç”¨åˆ†é˜ç·šè£œé½Šæ—¥ç·š
# æ™ºæ…§æ¨¡å¼ï¼ˆè‡ªå‹•æª¢æ¸¬åˆ†é˜ç·šç¯„åœå…§çš„æ‰€æœ‰ç¼ºå¤±ï¼‰
docker compose exec backend python /app/scripts/backfill_daily_from_minute.py --smart

# åƒ…æª¢æŸ¥ï¼ˆä¸ä¿®å¾©ï¼‰
docker compose exec backend python /app/scripts/backfill_daily_from_minute.py --smart --check

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ä¸‰ã€‘å‚™ä»½èˆ‡é‚„åŸ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… PostgreSQL è³‡æ–™åº«å‚™ä»½
# ä½¿ç”¨å‚™ä»½è…³æœ¬ï¼ˆæ¨è–¦ï¼‰
bash scripts/backup_database.sh

# æ‰‹å‹•å‚™ä»½
docker compose exec -T postgres pg_dump -U quantlab quantlab | gzip > /home/ubuntu/QuantLab/backups/quantlab_$(date +%Y%m%d).sql.gz

âœ… ç³»çµ±é·ç§»å‚™ä»½ï¼ˆå®Œæ•´æ‰“åŒ…ï¼‰
bash scripts/backup-for-migration.sh
# è¼¸å‡º: quantlab_migration_YYYYMMDD_HHMMSS.tar.gz

âœ… å¾å‚™ä»½é‚„åŸç³»çµ±
# è§£å£“ç¸®é·ç§»å‚™ä»½
tar -xzf quantlab_migration_20251230_143000.tar.gz

# é‚„åŸç³»çµ±
bash scripts/restore-from-backup.sh quantlab_migration_20251230_143000/

âœ… Qlib æ•¸æ“šå‚™ä»½èˆ‡é‚„åŸ
# å¾å®¹å™¨è¤‡è£½å‡ºä¾†ä¸¦å£“ç¸®
docker compose cp backend:/data/qlib/tw_stock_v2 /tmp/qlib_backup
tar -czf /home/ubuntu/QuantLab/backups/qlib_data_$(date +%Y%m%d).tar.gz -C /tmp qlib_backup
rm -rf /tmp/qlib_backup

# å¾å‚™ä»½é‚„åŸ
tar -xzf /home/ubuntu/QuantLab/backups/qlib_data_20241213.tar.gz -C /tmp/
docker compose cp /tmp/qlib_backup/tw_stock_v2 backend:/data/qlib/
docker compose exec backend ls -lh /data/qlib/tw_stock_v2/

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€å››ã€‘æœŸè²¨èˆ‡é¸æ“‡æ¬Š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… æœŸè²¨åˆç´„ç®¡ç†ï¼ˆå·²è‡ªå‹•åŒ–ï¼‰
# 1. è¨»å†Šæœˆä»½åˆç´„ï¼ˆç³»çµ±è‡ªå‹•åŸ·è¡Œï¼Œæ¯å¹´ 1/1 00:05ï¼‰
docker compose exec backend python /app/scripts/register_futures_contracts.py

# 2. åŒæ­¥æœŸè²¨æ•¸æ“šï¼ˆæ¯å¤© 15:30 è‡ªå‹•åŸ·è¡Œï¼‰
docker compose exec backend python /app/scripts/sync_shioaji_to_qlib.py --stocks TX,MTX --smart

# 3. ç”Ÿæˆé€£çºŒåˆç´„ï¼ˆæ¯é€±å…­ 18:00 è‡ªå‹•åŸ·è¡Œï¼‰
docker compose exec backend python /app/scripts/generate_continuous_contract.py \
  --symbol TX --start-date 2025-12-01 --end-date 2025-12-31

âœ… é¸æ“‡æ¬Šæ•¸æ“šå›è£œ
# æ¸¬è©¦æ¨¡å¼ï¼ˆ3 å¤©ï¼Œä¸å¯«å…¥è³‡æ–™åº«ï¼‰
docker compose exec backend python /app/scripts/backfill_option_data.py \
  --underlying TX --days-back 3 --dry-run

# å›è£œæœ€è¿‘ 7 å¤©
docker compose exec backend python /app/scripts/backfill_option_data.py \
  --underlying TX --days-back 7

# å›è£œå®Œæ•´ 90 å¤©
docker compose exec backend python /app/scripts/backfill_option_data.py \
  --underlying TX --days-back 90

# é©—è­‰é¸æ“‡æ¬Šæ•¸æ“šå“è³ª
docker compose exec postgres psql -U quantlab quantlab -c "
SELECT date, avg_call_delta, avg_put_delta,
       ROUND((avg_call_delta - 0.5) / NULLIF(atm_iv, 0), 3) as delta_iv_ratio
FROM option_daily_factors
WHERE underlying_id = 'TX'
ORDER BY date DESC LIMIT 10;"

âœ… ç­–ç•¥åƒæ•¸é…ç½®ç¯„ä¾‹
# è‚¡ç¥¨ç­–ç•¥
{
  "short_ma": 5,
  "long_ma": 20,
  "stocks": ["2330", "2317", "2454"]
}

# æœŸè²¨ç­–ç•¥
{
  "stocks": ["TX", "MTX"]           # æœˆä»½åˆç´„ï¼ˆæœƒè‡ªå‹•æ›æœˆï¼‰
}
# æˆ–
{
  "stocks": ["TXCONT", "MTXCONT"]   # é€£çºŒåˆç´„ï¼ˆç„¡åˆ°æœŸæ—¥ï¼‰
}

# é¸æ“‡æ¬Šç­–ç•¥
{
  "stocks": ["TX"]                  # TX ç‚ºé¸æ“‡æ¬Šæ¨™çš„
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€äº”ã€‘Celery ä»»å‹™ç®¡ç†
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… è‡ªå‹•åŒæ­¥æ’ç¨‹ï¼ˆå…± 11 å€‹ä¸»è¦ Celery å®šæ™‚ä»»å‹™ï¼‰
æ³¨æ„ï¼š
- æ‰€æœ‰æ™‚é–“å‡ç‚º UTC æ™‚é–“ï¼ˆå°åŒ—æ™‚é–“ = UTC + 8ï¼‰
- ä»¥ä¸‹ç‚º Python ä»»å‹™ï¼Œé .sh è…³æœ¬ï¼ˆé…ç½®æ–¼ backend/app/core/celery_app.pyï¼‰
- éƒ¨åˆ†ä»»å‹™å°æ‡‰æ‰‹å‹•åŸ·è¡Œçš„ .sh è…³æœ¬ï¼ˆæ¨™è¨» ğŸ”—ï¼‰

1. cleanup-cache-daily             - æ¯å¤© UTC 19:00ï¼ˆå°åŒ—éš”å¤© 03:00ï¼‰æ¸…ç†å¿«å–
2. cleanup-celery-metadata         - æ¯å¤© UTC 21:00ï¼ˆå°åŒ—éš”å¤© 05:00ï¼‰æ¸…ç† Celery å…ƒæ•¸æ“š
3. cleanup-stuck-rdagent-tasks ğŸ”—  - æ¯å¤© UTC 21:30ï¼ˆå°åŒ—éš”å¤© 05:30ï¼‰æ¸…ç†å¡ä½çš„ RD-Agent ä»»å‹™
4. check-database-integrity ğŸ”—     - æ¯å¤© UTC 22:00ï¼ˆå°åŒ—éš”å¤© 06:00ï¼‰è³‡æ–™åº«å®Œæ•´æ€§æª¢æŸ¥
5. auto-fix-database ğŸ”—            - æ¯å¤© UTC 22:30ï¼ˆå°åŒ—éš”å¤© 06:30ï¼‰è‡ªå‹•ä¿®å¾©ç¼ºå¤±æ•¸æ“š
6. sync-stock-list-daily           - æ¯å¤© UTC 00:00ï¼ˆå°åŒ— 08:00ï¼‰åŒæ­¥è‚¡ç¥¨æ¸…å–®
7. sync-latest-prices-frequent     - äº¤æ˜“æ—¥æ¯ 15 åˆ†é˜ï¼ˆå°åŒ— 09:00-13:59ï¼‰åŒæ­¥æœ€æ–°åƒ¹æ ¼
8. sync-shioaji-minute-daily       - äº¤æ˜“æ—¥ UTC 07:00ï¼ˆå°åŒ— 15:00ï¼‰Shioaji åˆ†é˜ç·šï¼ˆTop 50ï¼‰
9. sync-shioaji-futures-daily      - äº¤æ˜“æ—¥ UTC 07:30ï¼ˆå°åŒ— 15:30ï¼‰æœŸè²¨åˆ†é˜ç·šï¼ˆTX/MTXï¼‰
10. sync-daily-prices              - æ¯å¤© UTC 13:00ï¼ˆå°åŒ— 21:00ï¼‰æ¯æ—¥åƒ¹æ ¼
11. sync-fundamental-weekly        - æ¯é€±å…­ UTC 20:00ï¼ˆå°åŒ—é€±æ—¥ 04:00ï¼‰å®Œæ•´è²¡å‹™åŒæ­¥

ğŸ”— æ¨™è¨»ï¼šå°æ‡‰çš„æ‰‹å‹•åŸ·è¡Œ .sh è…³æœ¬ï¼ˆè©³è¦‹ä¸‹æ–¹å·¥å…·æŒ‡å—ï¼‰
   - cleanup-stuck-rdagent-tasks â†’ scripts/cleanup-stuck-rdagent-tasks.sh
   - check-database-integrity / auto-fix-database â†’ scripts/db-integrity-check.sh

âœ… ç›£æ§å‘½ä»¤
# æŸ¥çœ‹ Celery æœå‹™ç‹€æ…‹
docker compose ps celery-beat celery-worker

# æŸ¥çœ‹å·²è¨»å†Šä»»å‹™
docker compose exec backend celery -A app.core.celery_app inspect registered

# æŸ¥çœ‹å®šæ™‚ä»»å‹™æ¸…å–®
docker compose exec backend celery -A app.core.celery_app inspect scheduled

# æŸ¥çœ‹æ´»å‹•ä»»å‹™
docker compose exec backend celery -A app.core.celery_app inspect active

# å³æ™‚æŸ¥çœ‹æ—¥èªŒ
docker compose logs -f celery-worker
docker compose logs -f celery-beat

# æª¢æŸ¥ revoked tasks
docker compose exec backend celery -A app.core.celery_app inspect revoked

âœ… æ‰‹å‹•è§¸ç™¼ä»»å‹™
# æ¸…ç† Celery å…ƒæ•¸æ“š
docker compose exec backend celery -A app.core.celery_app call app.tasks.cleanup_celery_metadata

# æ¸…ç†å¡ä½çš„ RD-Agent ä»»å‹™
bash scripts/cleanup-stuck-rdagent-tasks.sh

# é‡å•Ÿ Celery Worker
bash scripts/restart-celery.sh

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€å…­ã€‘è³‡æ–™åº«æ“ä½œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… é€²å…¥ PostgreSQL äº’å‹•å¼ä»‹é¢
docker compose exec postgres psql -U quantlab quantlab

âœ… åŸ·è¡Œè³‡æ–™åº«é·ç§»
# åŸ·è¡Œé·ç§»ï¼ˆéƒ¨ç½²æ–°ç‰ˆæœ¬æ™‚å¿…é ˆï¼‰
docker compose exec backend alembic upgrade head

# å‰µå»ºæ–°é·ç§»ï¼ˆä¿®æ”¹ models/ å¾Œï¼‰
docker compose exec backend alembic revision --autogenerate -m "æè¿°è®Šæ›´"

# æŸ¥çœ‹é·ç§»æ­·å²
docker compose exec backend alembic history

âœ… å¸¸ç”¨æŸ¥è©¢
# æŸ¥çœ‹è‚¡ç¥¨æ•¸é‡
docker compose exec postgres psql -U quantlab quantlab -c "SELECT COUNT(*) FROM stocks;"

# æŸ¥çœ‹æœ€æ–°åƒ¹æ ¼æ—¥æœŸ
docker compose exec postgres psql -U quantlab quantlab -c "
SELECT stock_id, MAX(date) as latest_date
FROM stock_prices
GROUP BY stock_id
ORDER BY latest_date DESC
LIMIT 10;"

# æª¢æŸ¥åˆ†é˜ç·šæ•¸æ“šç¯„åœ
docker compose exec postgres psql -U quantlab quantlab -c "
SELECT stock_id, MIN(datetime::date), MAX(datetime::date), COUNT(DISTINCT datetime::date)
FROM stock_minute_prices
WHERE stock_id IN ('2330', 'TX', 'TXCONT')
GROUP BY stock_id;"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ä¸ƒã€‘RD-Agent AI å› å­æŒ–æ˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… åŸ·è¡Œ LLM å› å­æŒ–æ˜
# åŸ·è¡Œå®Œæ•´ LLM å› å­æŒ–æ˜ï¼ˆéœ€è¦ OpenAI API Keyï¼‰
docker compose exec backend python /app/run_rdagent_llm.py

# èƒŒæ™¯åŸ·è¡Œï¼ˆæ¨è–¦ï¼Œé¿å…çµ‚ç«¯æ–·ç·šï¼‰
nohup docker compose exec -T backend python /app/run_rdagent_llm.py > /tmp/rdagent_output.log 2>&1 &

# æŸ¥çœ‹åŸ·è¡Œæ—¥èªŒ
tail -f /tmp/rdagent_output.log

âœ… æª¢æŸ¥ä»»å‹™ç‹€æ…‹
# æŸ¥çœ‹æœ€è¿‘çš„ RD-Agent ä»»å‹™
docker compose exec postgres psql -U quantlab quantlab -c "
SELECT id, task_type, status, llm_calls, llm_cost, created_at
FROM rdagent_tasks
ORDER BY created_at DESC LIMIT 5;"

# æŸ¥çœ‹ç”Ÿæˆçš„å› å­
docker compose exec postgres psql -U quantlab quantlab -c "
SELECT id, name, category, formula, created_at
FROM generated_factors
ORDER BY created_at DESC LIMIT 5;"

âœ… æ¸…ç†å¡ä½çš„ä»»å‹™
# ä½¿ç”¨é è¨­è¶…æ™‚ï¼ˆ24 å°æ™‚ï¼‰
bash scripts/cleanup-stuck-rdagent-tasks.sh

# è‡ªè¨‚è¶…æ™‚ï¼ˆ12 å°æ™‚ = 43200 ç§’ï¼‰
bash scripts/cleanup-stuck-rdagent-tasks.sh 43200

âœ… æ¨¡å‹ç”Ÿæˆé¸é …
- model_type: "Tabular" â†’ è‡ªå‹•ä½¿ç”¨ MLP
- model_type: "TimeSeries" + architecture åŒ…å« "Transformer" â†’ ä½¿ç”¨ Transformer
- model_type: "TimeSeries" + architecture åŒ…å« "LSTM" â†’ ä½¿ç”¨ LSTM
- model_type: "TimeSeries" + å…¶ä»– â†’ é è¨­ä½¿ç”¨ GRU

âœ… è¨ªå•å‰ç«¯ä»‹é¢
http://localhost:3000/rdagent

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€å…«ã€‘ç¶²è·¯è¨ºæ–·
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… ç¶²è·¯è¨ºæ–·å·¥å…·
# å¿«é€Ÿè¨ºæ–·
bash scripts/network-diagnosis.sh

# æª¢æŸ¥ç«¯å£ç‹€æ…‹
bash scripts/open-ports.sh

# ä¿®å¾© SSH æ–·ç·šå•é¡Œ
bash scripts/fix-ssh-keepalive.sh

âœ… é–‹æ”¾ç«¯å£ï¼ˆå¦‚éœ€è¦ï¼‰
sudo ufw allow 22/tcp     # SSH
sudo ufw allow 80/tcp     # HTTP
sudo ufw allow 443/tcp    # HTTPS
sudo ufw allow 3000/tcp   # Frontend
sudo ufw allow 8000/tcp   # Backend API

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ä¹ã€‘Git æ“ä½œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… åŸºæœ¬æ“ä½œ
git status
git add .
git commit -m "message"
git push origin master

âœ… æ”¾æ£„ä¿®æ”¹
git checkout .

âœ… é ç¨‹å€‰åº«
git remote add origin http://git.dama168.com:3000/robert/QLab.git

================================================================================
âœ… ç³»çµ±ç¶­è­·å·¥å…·å®Œæ•´æŒ‡å— (17 å€‹æ ¸å¿ƒè…³æœ¬)
================================================================================

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ä¸€ã€‘æ ¸å¿ƒç³»çµ±å·¥å…· (2 å€‹) ğŸ”„ å®¹å™¨å•Ÿå‹•æ™‚è‡ªå‹•åŸ·è¡Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. backend/entrypoint.sh ğŸ”„ è‡ªå‹•åŸ·è¡Œ
   ç”¨é€”ï¼šDocker å®¹å™¨å•Ÿå‹•å…¥å£è…³æœ¬
   åŠŸèƒ½ï¼š
   - å»ºç«‹ RD-Agent å·¥ä½œç›®éŒ„ï¼ˆ/app/git_ignore_folder/ï¼‰
   - ä¿®å¾©ç›®éŒ„æ¬Šé™ï¼ˆchown quantlab:quantlabï¼‰
   - åˆ‡æ›åˆ° quantlab ç”¨æˆ¶åŸ·è¡Œæ‡‰ç”¨

   åŸ·è¡Œæ™‚æ©Ÿï¼šæ¯æ¬¡ backend å®¹å™¨å•Ÿå‹•æ™‚ï¼ˆDocker ENTRYPOINTï¼‰
   è§¸ç™¼æ–¹å¼ï¼šdocker compose up / restart backendï¼ˆè‡ªå‹•åŸ·è¡Œï¼‰

2. backend/start.sh ğŸ”„ è‡ªå‹•åŸ·è¡Œ
   ç”¨é€”ï¼šå¾Œç«¯æ‡‰ç”¨å•Ÿå‹•è…³æœ¬
   åŠŸèƒ½ï¼š
   - åŸ·è¡Œè³‡æ–™åº«é·ç§»ï¼ˆalembic upgrade headï¼‰
   - æ ¹æ“šç’°å¢ƒå•Ÿå‹• Uvicorn æœå‹™å™¨
     * ç”Ÿç”¢ç’°å¢ƒï¼š4 workersï¼ˆé«˜ä¸¦ç™¼ï¼‰
     * é–‹ç™¼ç’°å¢ƒï¼š--reload æ¨¡å¼ï¼ˆå³æ™‚æ›´æ–°ï¼‰

   åŸ·è¡Œæ™‚æ©Ÿï¼šæ¯æ¬¡ backend å®¹å™¨å•Ÿå‹•æ™‚ï¼ˆDocker CMDï¼‰
   è§¸ç™¼æ–¹å¼ï¼šdocker compose up / restart backendï¼ˆè‡ªå‹•åŸ·è¡Œï¼‰

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€äºŒã€‘æ•¸æ“šç®¡ç†å·¥å…· (2 å€‹)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

3. scripts/sync-qlib-smart.sh
   ç”¨é€”ï¼šQlib æ™ºæ…§å¢é‡åŒæ­¥
   åŠŸèƒ½ï¼š
   - æª¢æŸ¥ Qlib æœ€å¾Œæ—¥æœŸï¼ŒåªåŒæ­¥ç¼ºå¤±çš„æ•¸æ“š
   - å¾ PostgreSQL è®€å–æ•¸æ“šä¸¦è½‰æ›ç‚º Qlib äºŒé€²åˆ¶æ ¼å¼
   - æ¯”å®Œæ•´é‡æ–°å°å‡ºå¿« 10-20 å€ï¼ˆ1-5 åˆ†é˜ vs 30-60 åˆ†é˜ï¼‰

   ä½¿ç”¨æ–¹å¼ï¼š
   # åŒæ­¥æ‰€æœ‰è‚¡ç¥¨ï¼ˆæ¨è–¦ï¼‰
   bash scripts/sync-qlib-smart.sh

   # åŒæ­¥å–®ä¸€è‚¡ç¥¨
   bash scripts/sync-qlib-smart.sh --stock 2330

   # æŒ‡å®šè¼¸å‡ºç›®éŒ„
   bash scripts/sync-qlib-smart.sh --output-dir /data/qlib/custom_dir

4. scripts/db-integrity-check.sh ğŸ”„ Celery å®šæ™‚ä»»å‹™è‡ªå‹•åŸ·è¡Œ
   ç”¨é€”ï¼šè³‡æ–™åº«å®Œæ•´æ€§æª¢æŸ¥èˆ‡ä¿®å¾©
   åŠŸèƒ½ï¼š
   - æª¢æŸ¥æ—¥ç·šå’Œåˆ†é˜ç·šæ•¸æ“šå®Œæ•´æ€§
   - é©—è­‰ Qlib æ•¸æ“šä¸€è‡´æ€§
   - è‡ªå‹•ä¿®å¾©ç¼ºå¤±æ•¸æ“š

   ä½¿ç”¨æ–¹å¼ï¼š
   # åƒ…æª¢æŸ¥ï¼ˆä¸ä¿®å¾©ï¼‰
   bash scripts/db-integrity-check.sh

   # æª¢æŸ¥ä¸¦è‡ªå‹•ä¿®å¾©
   bash scripts/db-integrity-check.sh --fix

   è‡ªå‹•åŸ·è¡Œï¼š
   - æ¯å¤© UTC 22:00ï¼ˆå°åŒ—éš”å¤© 06:00ï¼‰- å®Œæ•´æ€§æª¢æŸ¥ï¼ˆcheck-database-integrity-dailyï¼‰
   - æ¯å¤© UTC 22:30ï¼ˆå°åŒ—éš”å¤© 06:30ï¼‰- è‡ªå‹•ä¿®å¾©ç¼ºå¤±ï¼ˆauto-fix-database-dailyï¼‰
   - å°æ‡‰ Celery ä»»å‹™ï¼šcheck_database_integrity, auto_fix_database

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ä¸‰ã€‘å¿«å–ç®¡ç†å·¥å…· (2 å€‹)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

5. scripts/quick-clean.sh
   ç”¨é€”ï¼šå¿«é€Ÿæ¸…ç†å‰ç«¯å¿«å–ï¼ˆç„¡äº¤äº’ï¼‰
   åŠŸèƒ½ï¼š
   - åœæ­¢å‰ç«¯æœå‹™
   - æ¸…ç† Nuxt.js å¿«å–ï¼ˆ.nuxtã€.outputã€node_modules/.viteï¼‰
   - è‡ªå‹•é‡å•Ÿå‰ç«¯

   ä½¿ç”¨æ™‚æ©Ÿï¼š
   - å‰ç«¯ä»£ç¢¼æ›´æ–°å¾Œç„¡è®ŠåŒ–
   - é é¢é¡¯ç¤ºç•°å¸¸
   - é–‹ç™¼éšæ®µå¿«é€Ÿé‡ç½®

   ä½¿ç”¨æ–¹å¼ï¼š
   bash scripts/quick-clean.sh

6. scripts/clear-frontend-cache.sh
   ç”¨é€”ï¼šå®Œæ•´å‰ç«¯å¿«å–æ¸…ç†ï¼ˆå«å®¹å™¨å…§å¿«å–ï¼‰
   åŠŸèƒ½ï¼š
   - æ¸…ç†æœ¬åœ°å¿«å–ç›®éŒ„
   - æ¸…ç†å®¹å™¨å…§å¿«å–
   - é‡å»ºå‰ç«¯å®¹å™¨
   - é¡¯ç¤ºæ¸…ç†çµ±è¨ˆ

   ä½¿ç”¨æ–¹å¼ï¼š
   bash scripts/clear-frontend-cache.sh

   èªªæ˜ï¼šæ¯” quick-clean.sh æ›´å¾¹åº•ï¼Œä½†éœ€è¦æ›´é•·æ™‚é–“

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€å››ã€‘æœå‹™ç®¡ç†å·¥å…· (2 å€‹)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

7. scripts/restart-celery.sh
   ç”¨é€”ï¼šé‡å•Ÿ Celery Worker
   åŠŸèƒ½ï¼š
   - é‡å•Ÿ celery-worker å®¹å™¨
   - æª¢æŸ¥ Worker å¥åº·ç‹€æ…‹ï¼ˆping æ¸¬è©¦ï¼‰
   - é¡¯ç¤ºå·²è¨»å†Šä»»å‹™æ¸…å–®

   ä½¿ç”¨æ™‚æ©Ÿï¼š
   - å¾Œç«¯ä»£ç¢¼æ›´æ–°å¾Œï¼ˆTask å®šç¾©è®Šæ›´ï¼‰
   - Worker å¡ä½æˆ–ç„¡éŸ¿æ‡‰
   - éœ€è¦é‡æ–°è¼‰å…¥ä»»å‹™é…ç½®

   ä½¿ç”¨æ–¹å¼ï¼š
   bash scripts/restart-celery.sh

8. scripts/reset-rate-limit.sh
   ç”¨é€”ï¼šé‡ç½® API é€Ÿç‡é™åˆ¶
   åŠŸèƒ½ï¼š
   - æŸ¥è©¢ Redis ä¸­çš„é€Ÿç‡é™åˆ¶ keys
   - æä¾›äº’å‹•å¼é¸å–®ï¼š
     1) åˆªé™¤æ‰€æœ‰é€Ÿç‡é™åˆ¶
     2) åƒ…åˆªé™¤ RD-Agent ç›¸é—œ
     3) åƒ…åˆªé™¤å› å­æŒ–æ˜
     4) åƒ…åˆªé™¤ç­–ç•¥å„ªåŒ–

   ä½¿ç”¨æ™‚æ©Ÿï¼š
   - é–‹ç™¼/æ¸¬è©¦éšæ®µé »ç¹æ¸¬è©¦ API
   - è§¸ç™¼é€Ÿç‡é™åˆ¶ï¼ˆ429 Too Many Requestsï¼‰
   - æ¸…ç†ç‰¹å®šåŠŸèƒ½çš„é™åˆ¶

   ä½¿ç”¨æ–¹å¼ï¼š
   bash scripts/reset-rate-limit.sh
   # äº’å‹•å¼é¸å–®ï¼Œæ ¹æ“šæç¤ºé¸æ“‡æ“ä½œ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€äº”ã€‘ä»»å‹™ç®¡ç†å·¥å…· (1 å€‹) ğŸ”„ Celery å®šæ™‚ä»»å‹™è‡ªå‹•åŸ·è¡Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

9. scripts/cleanup-stuck-rdagent-tasks.sh ğŸ”„ Celery å®šæ™‚ä»»å‹™è‡ªå‹•åŸ·è¡Œ
   ç”¨é€”ï¼šæ¸…ç†å¡ä½çš„ RD-Agent ä»»å‹™
   åŠŸèƒ½ï¼š
   - æª¢æ¸¬åŸ·è¡Œè¶…é 24 å°æ™‚ä»è™•æ–¼ RUNNING çš„ä»»å‹™
   - è‡ªå‹•æ¨™è¨˜ç‚º FAILED ä¸¦è¨˜éŒ„éŒ¯èª¤è¨Šæ¯
   - é¡¯ç¤ºå¡ä½ä»»å‹™è©³æƒ…å’Œçµ±è¨ˆ
   - æª¢æŸ¥ Celery Worker ç‹€æ…‹

   ä½¿ç”¨æ–¹å¼ï¼š
   # ä½¿ç”¨é è¨­è¶…æ™‚ï¼ˆ24 å°æ™‚ï¼‰
   bash scripts/cleanup-stuck-rdagent-tasks.sh

   # è‡ªè¨‚è¶…æ™‚ï¼ˆ12 å°æ™‚ = 43200 ç§’ï¼‰
   bash scripts/cleanup-stuck-rdagent-tasks.sh 43200

   è‡ªå‹•åŸ·è¡Œï¼š
   - æ¯å¤© UTC 21:30ï¼ˆå°åŒ—éš”å¤© 05:30ï¼‰è‡ªå‹•æ¸…ç†
   - å°æ‡‰ Celery ä»»å‹™ï¼šcleanup-stuck-rdagent-tasks-daily
   - è¶…æ™‚è¨­å®šï¼š24 å°æ™‚

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€å…­ã€‘å‚™ä»½é‚„åŸå·¥å…· (3 å€‹)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

10. scripts/backup_database.sh
    ç”¨é€”ï¼šPostgreSQL è³‡æ–™åº«å®šæœŸå‚™ä»½
    åŠŸèƒ½ï¼š
    - å®Œæ•´å‚™ä»½ quantlab è³‡æ–™åº«
    - è‡ªå‹•å‘½åï¼ˆquantlab_backup_YYYYMMDD_HHMMSS.sqlï¼‰
    - è¨˜éŒ„å‚™ä»½æ—¥èªŒ
    - æ¸…ç† 30 å¤©å‰çš„èˆŠå‚™ä»½

    ä½¿ç”¨æ–¹å¼ï¼š
    bash scripts/backup_database.sh

    å‚™ä»½ä½ç½®ï¼š/home/ubuntu/QuantLab/backups/
    å»ºè­°ï¼šåŠ å…¥ cron å®šæœŸåŸ·è¡Œï¼ˆæ¯å¤©/æ¯é€±ï¼‰

11. scripts/backup-for-migration.sh
    ç”¨é€”ï¼šç³»çµ±é·ç§»å‚™ä»½ï¼ˆæ‰“åŒ…æ•´å€‹ç³»çµ±ï¼‰
    åŠŸèƒ½ï¼š
    - å‚™ä»½ PostgreSQL è³‡æ–™åº«
    - å‚™ä»½ Qlib æ•¸æ“šç›®éŒ„
    - å‚™ä»½ .env é…ç½®æ–‡ä»¶
    - ç”Ÿæˆé·ç§»æŒ‡å—æ–‡æª”
    - æ‰“åŒ…ç‚º tar.gz å£“ç¸®æª”

    ä½¿ç”¨æ–¹å¼ï¼š
    bash scripts/backup-for-migration.sh

    è¼¸å‡ºï¼šquantlab_migration_YYYYMMDD_HHMMSS.tar.gz
    ç”¨é€”ï¼šé·ç§»åˆ°æ–°æ©Ÿå™¨ã€ç½é›£æ¢å¾©ã€ç‰ˆæœ¬å‡ç´šå‰å‚™ä»½

12. scripts/restore-from-backup.sh
    ç”¨é€”ï¼šå¾å‚™ä»½é‚„åŸç³»çµ±
    åŠŸèƒ½ï¼š
    - è‡ªå‹•æª¢æ¸¬å‚™ä»½ç›®éŒ„çµæ§‹
    - é‚„åŸ PostgreSQL è³‡æ–™åº«
    - é‚„åŸ Qlib æ•¸æ“šç›®éŒ„
    - é‚„åŸ .env é…ç½®æ–‡ä»¶
    - åŸ·è¡Œè³‡æ–™åº«é·ç§»ï¼ˆalembic upgrade headï¼‰

    ä½¿ç”¨æ–¹å¼ï¼š
    bash scripts/restore-from-backup.sh /path/to/backup/directory

    ç¯„ä¾‹ï¼š
    # è§£å£“ç¸®é·ç§»å‚™ä»½
    tar -xzf quantlab_migration_20251230_143000.tar.gz

    # é‚„åŸç³»çµ±
    bash scripts/restore-from-backup.sh quantlab_migration_20251230_143000/

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ä¸ƒã€‘ç³»çµ±é…ç½®å·¥å…· (2 å€‹)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

13. scripts/setup.sh
    ç”¨é€”ï¼šåˆå§‹ç’°å¢ƒè¨­ç½®
    åŠŸèƒ½ï¼š
    - æª¢æŸ¥ Docker å’Œ Docker Compose å®‰è£
    - å»ºç«‹ .env é…ç½®æ–‡ä»¶ï¼ˆå¾ .env.exampleï¼‰
    - æç¤ºå¿…è¦é…ç½®é …

    ä½¿ç”¨æ™‚æ©Ÿï¼š
    - å…¨æ–°éƒ¨ç½²
    - åˆæ¬¡è¨­ç½®ç’°å¢ƒ

    ä½¿ç”¨æ–¹å¼ï¼š
    bash scripts/setup.sh

    å¿…å¡«é…ç½®ï¼š
    - DB_PASSWORDï¼ˆè³‡æ–™åº«å¯†ç¢¼ï¼‰
    - JWT_SECRETï¼ˆJWT é‡‘é‘°ï¼‰
    - FINLAB_API_TOKENï¼ˆFinLab API Tokenï¼‰

14. scripts/generate-credentials.sh
    ç”¨é€”ï¼šç”Ÿæˆå®‰å…¨æ†‘è­‰
    åŠŸèƒ½ï¼š
    - ç”Ÿæˆ JWT_SECRETï¼ˆ64 å­—å…ƒéš¨æ©Ÿå­—ä¸²ï¼‰
    - ç”Ÿæˆ DB_PASSWORDï¼ˆ32 å­—å…ƒå¼·å¯†ç¢¼ï¼‰
    - ç”Ÿæˆ ENCRYPTION_KEYï¼ˆFernet æ ¼å¼é‡‘é‘°ï¼‰
    - ä½¿ç”¨åŠ å¯†å­¸å®‰å…¨çš„éš¨æ©Ÿæ•¸ç”Ÿæˆå™¨

    ä½¿ç”¨æ™‚æ©Ÿï¼š
    - æ–°éƒ¨ç½²ç’°å¢ƒ
    - é‡ç½®å®‰å…¨æ†‘è­‰
    - å®‰å…¨å¯©è¨ˆå¾Œæ›´æ–°æ†‘è­‰

    ä½¿ç”¨æ–¹å¼ï¼š
    bash scripts/generate-credentials.sh

    èªªæ˜ï¼šå°‡è¼¸å‡ºè¤‡è£½åˆ° .env æ–‡ä»¶ä¸­å°æ‡‰æ¬„ä½

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€å…«ã€‘ç¶²è·¯è¨ºæ–·å·¥å…· (3 å€‹)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

15. scripts/fix-ssh-keepalive.sh
    ç”¨é€”ï¼šä¿®å¾© SSH é€£ç·šæ–·ç·šå•é¡Œ
    åŠŸèƒ½ï¼š
    - å„ªåŒ– SSH Keep-Alive è¨­å®š
    - å‚™ä»½åŸå§‹ sshd_config
    - è¨­å®š ClientAliveInterval=30ï¼ˆæ¯ 30 ç§’ç™¼é€å¿ƒè·³ï¼‰
    - è¨­å®š ClientAliveCountMax=5ï¼ˆæœ€å¤š 5 æ¬¡ç„¡éŸ¿æ‡‰ï¼‰
    - ç¸½è¶…æ™‚æ™‚é–“ï¼š150 ç§’ï¼ˆ2.5 åˆ†é˜ï¼‰

    ä½¿ç”¨æ™‚æ©Ÿï¼š
    - SSH é€£ç·šç¶“å¸¸æ–·ç·š
    - NAT è¶…æ™‚å°è‡´é€£ç·šä¸­æ–·

    ä½¿ç”¨æ–¹å¼ï¼š
    bash scripts/fix-ssh-keepalive.sh

    èªªæ˜ï¼šéœ€è¦ sudo æ¬Šé™ï¼Œä¿®æ”¹å¾Œè‡ªå‹•é‡æ–°è¼‰å…¥ SSH æœå‹™

16. scripts/network-diagnosis.sh
    ç”¨é€”ï¼šç¶²è·¯è¨ºæ–·
    åŠŸèƒ½ï¼š
    - é¡¯ç¤ºç³»çµ±è³‡æºç‹€æ…‹ï¼ˆè² è¼‰ã€è¨˜æ†¶é«”ã€ç£ç¢Ÿï¼‰
    - é¡¯ç¤º Docker å®¹å™¨ç‹€æ…‹
    - çµ±è¨ˆ TCP é€£æ¥ç‹€æ…‹åˆ†å¸ƒ
    - æª¢æŸ¥é—œéµæœå‹™ç«¯å£ï¼ˆ22/80/443/3000/8000/5432/6379ï¼‰
    - é¡¯ç¤º SSH é€£æ¥æ­·å²
    - é¡¯ç¤º SSH Keep-Alive è¨­å®š
    - æ¸¬è©¦ç¶²è·¯å»¶é²ï¼ˆGoogle DNSã€Cloudflare DNSï¼‰

    ä½¿ç”¨æ™‚æ©Ÿï¼š
    - ç¶²è·¯å•é¡Œæ’æŸ¥
    - é€£ç·šç•°å¸¸è¨ºæ–·
    - ç³»çµ±å¥åº·æª¢æŸ¥

    ä½¿ç”¨æ–¹å¼ï¼š
    bash scripts/network-diagnosis.sh

17. scripts/open-ports.sh
    ç”¨é€”ï¼šæª¢æŸ¥ç«¯å£å’Œé˜²ç«ç‰†ç‹€æ…‹
    åŠŸèƒ½ï¼š
    - é¡¯ç¤º UFW é˜²ç«ç‰†ç‹€æ…‹
    - åˆ—å‡ºæ­£åœ¨ç›£è½çš„ç«¯å£
    - é¡¯ç¤º Docker ç«¯å£æ˜ å°„
    - æ¸¬è©¦ç«¯å£å¯é”æ€§ï¼ˆlocalhostï¼‰
      * Port 22 (SSH)
      * Port 80 (HTTP)
      * Port 443 (HTTPS)
      * Port 3000 (Frontend)
      * Port 8000 (Backend API)
      * Port 5432 (PostgreSQL)
      * Port 6379 (Redis)

    ä½¿ç”¨æ™‚æ©Ÿï¼š
    - éƒ¨ç½²å¾Œé©—è­‰ç«¯å£é…ç½®
    - ç„¡æ³•è¨ªå•æœå‹™æ™‚è¨ºæ–·
    - å®‰å…¨å¯©è¨ˆ

    ä½¿ç”¨æ–¹å¼ï¼š
    bash scripts/open-ports.sh

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ä¹ã€‘å¿«é€Ÿåƒè€ƒ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¸¸ç”¨ç¶­è­·å‘½ä»¤çµ„åˆï¼š

1. æ¯æ—¥é–‹ç™¼æµç¨‹
   bash scripts/quick-clean.sh              # æ¸…ç†å‰ç«¯å¿«å–
   bash scripts/reset-rate-limit.sh         # é‡ç½®é€Ÿç‡é™åˆ¶
   docker compose restart backend           # é‡å•Ÿå¾Œç«¯

2. ä»£ç¢¼æ›´æ–°å¾Œ
   docker compose restart backend celery-worker
   bash scripts/restart-celery.sh

3. æ•¸æ“šåŒæ­¥
   bash scripts/db-integrity-check.sh --fix # æª¢æŸ¥ä¸¦ä¿®å¾©

4. ç³»çµ±é·ç§»
   bash scripts/backup-for-migration.sh     # æ‰“åŒ…å‚™ä»½
   # å‚³è¼¸åˆ°æ–°æ©Ÿå™¨å¾Œ
   bash scripts/restore-from-backup.sh /path/to/backup/

5. å•é¡Œæ’æŸ¥
   bash scripts/network-diagnosis.sh        # ç¶²è·¯è¨ºæ–·
   bash scripts/open-ports.sh               # ç«¯å£æª¢æŸ¥
   bash scripts/cleanup-stuck-rdagent-tasks.sh  # æ¸…ç†å¡ä½ä»»å‹™

6. å®šæœŸç¶­è­·ï¼ˆå»ºè­°åŠ å…¥ cronï¼‰
   bash scripts/backup_database.sh          # æ¯å¤©å‚™ä»½
   bash scripts/db-integrity-check.sh --fix # æ¯å¤©æª¢æŸ¥

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€åã€‘æ³¨æ„äº‹é …
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš ï¸  å®‰å…¨æç¤ºï¼š
   - generate-credentials.sh ç”Ÿæˆçš„æ†‘è­‰è«‹å¦¥å–„ä¿ç®¡
   - backup_database.sh å‚™ä»½åŒ…å«æ•æ„Ÿæ•¸æ“šï¼Œæ³¨æ„æ¬Šé™è¨­å®š
   - restore-from-backup.sh æœƒè¦†è“‹ç¾æœ‰æ•¸æ“šï¼ŒåŸ·è¡Œå‰è«‹ç¢ºèª

âš ï¸  æ€§èƒ½æç¤ºï¼š
   - sync-qlib-smart.sh ä½¿ç”¨æ™ºæ…§å¢é‡ï¼Œæ¯”å®Œæ•´åŒæ­¥å¿« 10-20 å€
   - quick-clean.sh æ¯” clear-frontend-cache.sh æ›´å¿«ä½†ä¸å¤ å¾¹åº•
   - db-integrity-check.sh æ¯å¤©è‡ªå‹•åŸ·è¡Œï¼Œç„¡éœ€æ‰‹å‹•é‹è¡Œ

âš ï¸  ç¶²è·¯æç¤ºï¼š
   - fix-ssh-keepalive.sh éœ€è¦ sudo æ¬Šé™
   - open-ports.sh åƒ…æª¢æŸ¥ä¸ä¿®æ”¹é…ç½®
   - network-diagnosis.sh å¯å®‰å…¨é‡è¤‡åŸ·è¡Œ

âš ï¸  ä»»å‹™ç®¡ç†ï¼š
   - cleanup-stuck-rdagent-tasks.sh æ¯å¤©è‡ªå‹•åŸ·è¡Œ
   - restart-celery.sh æœƒä¸­æ–·æ­£åœ¨åŸ·è¡Œçš„ä»»å‹™
   - reset-rate-limit.sh é–‹ç™¼ç’°å¢ƒä½¿ç”¨ï¼Œç”Ÿç”¢ç’°å¢ƒæ…ç”¨

================================================================================
